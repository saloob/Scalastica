/*
 Rangy, a cross-browser JavaScript range and selection library
 http://code.google.com/p/rangy/

 Copyright 2012, Tim Down
 Licensed under the MIT license.
 Version: 1.2.3
 Build date: 26 February 2012
*/
window.rangy=function(){function c(a,b){var d=typeof a[b];return d==l||!!(d==o&&a[b])||"unknown"==d}function b(a,b){return!!(typeof a[b]==o&&a[b])}function a(a,b){return typeof a[b]!=i}function d(a){return function(b,d){for(var c=d.length;c--;)if(!a(b,d[c]))return!1;return!0}}function g(a){return a&&m(a,u)&&y(a,q)}function e(a){window.alert("Rangy not supported in your browser. Reason: "+a);p.initialized=!0;p.supported=!1}function f(){if(!p.initialized){var a,d=!1,s=!1;c(document,"createRange")&&
(a=document.createRange(),m(a,r)&&y(a,x)&&(d=!0),a.detach());if((a=b(document,"body")?document.body:document.getElementsByTagName("body")[0])&&c(a,"createTextRange"))a=a.createTextRange(),g(a)&&(s=!0);!d&&!s&&e("Neither Range nor TextRange are implemented");p.initialized=!0;p.features={implementsDomRange:d,implementsTextRange:s};d=D.concat(B);s=0;for(a=d.length;s<a;++s)try{d[s](p)}catch(f){b(window,"console")&&c(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",
f)}}}function k(a){this.name=a;this.supported=this.initialized=!1}var o="object",l="function",i="undefined",x="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer START_TO_START START_TO_END END_TO_START END_TO_END".split(" "),r="setStart setStartBefore setStartAfter setEnd setEndBefore setEndAfter collapse selectNode selectNodeContents compareBoundaryPoints deleteContents extractContents cloneContents insertNode surroundContents cloneRange toString detach".split(" "),
q="boundingHeight boundingLeft boundingTop boundingWidth htmlText text".split(" "),u="collapse compareEndPoints duplicate getBookmark moveToBookmark moveToElementText parentElement pasteHTML select setEndPoint getBoundingClientRect".split(" "),m=d(c),s=d(b),y=d(a),p={version:"1.2.3",initialized:!1,supported:!0,util:{isHostMethod:c,isHostObject:b,isHostProperty:a,areHostMethods:m,areHostObjects:s,areHostProperties:y,isTextRange:g},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};
p.fail=e;p.warn=function(a){a="Rangy warning: "+a;p.config.alertOnWarn?window.alert(a):typeof window.console!=i&&typeof window.console.log!=i&&window.console.log(a)};({}).hasOwnProperty?p.util.extend=function(a,b){for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d])}:e("hasOwnProperty not supported");var B=[],D=[];p.init=f;p.addInitListener=function(a){p.initialized?a(p):B.push(a)};var C=[];p.addCreateMissingNativeApiListener=function(a){C.push(a)};p.createMissingNativeApi=function(a){a=a||window;f();
for(var b=0,d=C.length;b<d;++b)C[b](a)};k.prototype.fail=function(a){this.initialized=!0;this.supported=!1;throw Error("Module '"+this.name+"' failed to load: "+a);};k.prototype.warn=function(a){p.warn("Module "+this.name+": "+a)};k.prototype.createError=function(a){return Error("Error in Rangy "+this.name+" module: "+a)};p.createModule=function(a,b){var d=new k(a);p.modules[a]=d;D.push(function(a){b(a,d);d.initialized=!0;d.supported=!0})};p.requireModules=function(a){for(var b=0,d=a.length,c,g;b<
d;++b){g=a[b];c=p.modules[g];if(!c||!(c instanceof k))throw Error("Module '"+g+"' not found");if(!c.supported)throw Error("Module '"+g+"' not supported");}};var z=!1,s=function(){z||(z=!0,p.initialized||f())};if(typeof window==i)e("No window found");else if(typeof document==i)e("No document found");else return c(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",s,!1),c(window,"addEventListener")?window.addEventListener("load",s,!1):c(window,"attachEvent")?window.attachEvent("onload",
s):e("Window does not have required addEventListener or attachEvent method"),p}();
rangy.createModule("DomUtil",function(c,b){function a(a){for(var b=0;a=a.previousSibling;)b++;return b}function d(a,b){var d=[],c;for(c=a;c;c=c.parentNode)d.push(c);for(c=b;c;c=c.parentNode)if(m(d,c))return c;return null}function g(a,b,d){for(d=d?a:a.parentNode;d;){a=d.parentNode;if(a===b)return d;d=a}return null}function e(a){a=a.nodeType;return 3==a||4==a||8==a}function f(a,b){var d=b.nextSibling,c=b.parentNode;d?c.insertBefore(a,d):c.appendChild(a);return a}function k(a){if(9==a.nodeType)return a;
if(typeof a.ownerDocument!=r)return a.ownerDocument;if(typeof a.document!=r)return a.document;if(a.parentNode)return k(a.parentNode);throw Error("getDocument: no document found for node");}function o(a){return!a?"[No node]":e(a)?'"'+a.data+'"':1==a.nodeType?"<"+a.nodeName+(a.id?' id="'+a.id+'"':"")+">["+a.childNodes.length+"]":a.nodeName}function l(a){this._next=this.root=a}function i(a,b){this.node=a;this.offset=b}function x(a){this.code=this[a];this.codeName=a;this.message="DOMException: "+this.codeName}
var r="undefined",q=c.util;q.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||b.fail("document missing a Node creation method");q.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method");var u=document.createElement("div");q.areHostMethods(u,["insertBefore","appendChild","cloneNode"])||b.fail("Incomplete Element implementation");q.isHostProperty(u,"innerHTML")||b.fail("Element is missing innerHTML property");u=document.createTextNode("test");
q.areHostMethods(u,["splitText","deleteData","insertData","appendData","cloneNode"])||b.fail("Incomplete Text Node implementation");var m=function(a,b){for(var d=a.length;d--;)if(a[d]===b)return!0;return!1};l.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next,b;if(this._current){b=a.firstChild;if(!b)for(b=null;a!==this.root&&!(b=a.nextSibling);)a=a.parentNode;this._next=b}return this._current},detach:function(){this._current=this._next=this.root=
null}};i.prototype={equals:function(a){return this.node===a.node&this.offset==a.offset},inspect:function(){return"[DomPosition("+o(this.node)+":"+this.offset+")]"}};x.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};x.prototype.toString=function(){return this.message};c.dom={arrayContains:m,isHtmlNamespace:function(a){var b;return typeof a.namespaceURI==r||null===(b=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==
b},parentElement:function(a){a=a.parentNode;return 1==a.nodeType?a:null},getNodeIndex:a,getNodeLength:function(a){var b;return e(a)?a.length:(b=a.childNodes)?b.length:0},getCommonAncestor:d,isAncestorOf:function(a,b,d){for(b=d?b:b.parentNode;b;){if(b===a)return!0;b=b.parentNode}return!1},getClosestAncestorIn:g,isCharacterDataNode:e,insertAfter:f,splitDataNode:function(a,b){var d=a.cloneNode(!1);d.deleteData(0,b);a.deleteData(b,a.length-b);f(d,a);return d},getDocument:k,getWindow:function(a){a=k(a);
if(typeof a.defaultView!=r)return a.defaultView;if(typeof a.parentWindow!=r)return a.parentWindow;throw Error("Cannot get a window object for node");},getIframeWindow:function(a){if(typeof a.contentWindow!=r)return a.contentWindow;if(typeof a.contentDocument!=r)return a.contentDocument.defaultView;throw Error("getIframeWindow: No Window object found for iframe element");},getIframeDocument:function(a){if(typeof a.contentDocument!=r)return a.contentDocument;if(typeof a.contentWindow!=r)return a.contentWindow.document;
throw Error("getIframeWindow: No Document object found for iframe element");},getBody:function(a){return q.isHostObject(a,"body")?a.body:a.getElementsByTagName("body")[0]},getRootContainer:function(a){for(var b;b=a.parentNode;)a=b;return a},comparePoints:function(b,c,e,f){var i;if(b==e)return c===f?0:c<f?-1:1;if(i=g(e,b,!0))return c<=a(i)?-1:1;if(i=g(b,e,!0))return a(i)<f?-1:1;c=d(b,e);b=b===c?c:g(b,c,!0);e=e===c?c:g(e,c,!0);if(b===e)throw Error("comparePoints got to case 4 and childA and childB are the same!");
for(c=c.firstChild;c;){if(c===b)return-1;if(c===e)return 1;c=c.nextSibling}throw Error("Should not be here!");},inspectNode:o,fragmentFromNodeChildren:function(a){for(var b=k(a).createDocumentFragment(),d;d=a.firstChild;)b.appendChild(d);return b},createIterator:function(a){return new l(a)},DomPosition:i};c.DOMException=x});
rangy.createModule("DomRange",function(c){function b(a,b){return 3!=a.nodeType&&(h.isAncestorOf(a,b.startContainer,!0)||h.isAncestorOf(a,b.endContainer,!0))}function a(a){return h.getDocument(a.startContainer)}function d(a,b,d){if(b=a._listeners[b])for(var c=0,g=b.length;c<g;++c)b[c].call(a,{target:a,args:d})}function g(a){return new H(a.parentNode,h.getNodeIndex(a))}function e(a){return new H(a.parentNode,h.getNodeIndex(a)+1)}function f(a,b,d){var c=11==a.nodeType?a.firstChild:a;h.isCharacterDataNode(b)?
d==b.length?h.insertAfter(a,b):b.parentNode.insertBefore(a,0==d?b:h.splitDataNode(b,d)):d>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[d]);return c}function k(b){for(var d,c,g=a(b.range).createDocumentFragment();c=b.next();){d=b.isPartiallySelectedSubtree();c=c.cloneNode(!d);d&&(d=b.getSubtreeIterator(),c.appendChild(k(d)),d.detach(!0));if(10==c.nodeType)throw new A("HIERARCHY_REQUEST_ERR");g.appendChild(c)}return g}function o(a,b,d){for(var c,g,d=d||{stop:!1};c=a.next();)if(a.isPartiallySelectedSubtree())if(!1===
b(c)){d.stop=!0;break}else{if(c=a.getSubtreeIterator(),o(c,b,d),c.detach(!0),d.stop)break}else for(c=h.createIterator(c);g=c.next();)if(!1===b(g)){d.stop=!0;return}}function l(a){for(var b;a.next();)a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),l(b),b.detach(!0)):a.remove()}function i(b){for(var d,c=a(b.range).createDocumentFragment(),g;d=b.next();){b.isPartiallySelectedSubtree()?(d=d.cloneNode(!1),g=b.getSubtreeIterator(),d.appendChild(i(g)),g.detach(!0)):b.remove();if(10==d.nodeType)throw new A("HIERARCHY_REQUEST_ERR");
c.appendChild(d)}return c}function x(a,b,d){var c=!(!b||!b.length),g,e=!!d;c&&(g=RegExp("^("+b.join("|")+")$"));var n=[];o(new q(a,!1),function(a){(!c||g.test(a.nodeType))&&(!e||d(a))&&n.push(a)});return n}function r(a){return"["+("undefined"==typeof a.getName?"Range":a.getName())+"("+h.inspectNode(a.startContainer)+":"+a.startOffset+", "+h.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function q(a,b){this.range=a;this.clonePartiallySelectedTextNodes=b;if(!a.collapsed){this.sc=a.startContainer;
this.so=a.startOffset;this.ec=a.endContainer;this.eo=a.endOffset;var d=a.commonAncestorContainer;this.sc===this.ec&&h.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===d&&!h.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:h.getClosestAncestorIn(this.sc,d,!0),this._last=this.ec===d&&!h.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:h.getClosestAncestorIn(this.ec,d,!0))}}function u(a){this.code=
this[a];this.codeName=a;this.message="RangeException: "+this.codeName}function m(a,b,d){this.nodes=x(a,b,d);this._next=this.nodes[0];this._position=0}function s(a){return function(b,d){for(var c,g=d?b:b.parentNode;g;){c=g.nodeType;if(h.arrayContains(a,c))return g;g=g.parentNode}return null}}function y(a,b){if(ca(a,b))throw new u("INVALID_NODE_TYPE_ERR");}function p(a){if(!a.startContainer)throw new A("INVALID_STATE_ERR");}function B(a,b){if(!h.arrayContains(b,a.nodeType))throw new u("INVALID_NODE_TYPE_ERR");
}function D(a,b){if(0>b||b>(h.isCharacterDataNode(a)?a.length:a.childNodes.length))throw new A("INDEX_SIZE_ERR");}function C(a,b){if(S(a,!0)!==S(b,!0))throw new A("WRONG_DOCUMENT_ERR");}function z(a){if(da(a,!0))throw new A("NO_MODIFICATION_ALLOWED_ERR");}function w(a,b){if(!a)throw new A(b);}function F(a){return!!a.startContainer&&!!a.endContainer&&!(!h.arrayContains(L,a.startContainer.nodeType)&&!S(a.startContainer,!0))&&!(!h.arrayContains(L,a.endContainer.nodeType)&&!S(a.endContainer,!0))&&a.startOffset<=
(h.isCharacterDataNode(a.startContainer)?a.startContainer.length:a.startContainer.childNodes.length)&&a.endOffset<=(h.isCharacterDataNode(a.endContainer)?a.endContainer.length:a.endContainer.childNodes.length)}function t(a){p(a);if(!F(a))throw Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")");}function K(){}function G(a){a.START_TO_START=T;a.START_TO_END=X;a.END_TO_END=ea;a.END_TO_START=Y;a.NODE_BEFORE=Z;a.NODE_AFTER=$;a.NODE_BEFORE_AND_AFTER=aa;a.NODE_INSIDE=U}function E(a){G(a);
G(a.prototype)}function M(a,b){return function(){t(this);var d=this.startContainer,c=this.startOffset,g=this.commonAncestorContainer,n=new q(this,!0);d!==g&&(d=h.getClosestAncestorIn(d,g,!0),c=e(d),d=c.node,c=c.offset);o(n,z);n.reset();g=a(n);n.detach();b(this,d,c,d,c);return g}}function P(a,d,n){function f(a,b){return function(d){p(this);B(d,I);B(Q(d),L);d=(a?g:e)(d);(b?o:m)(this,d.node,d.offset)}}function o(a,b,c){var g=a.endContainer,n=a.endOffset;if(b!==a.startContainer||c!==a.startOffset){if(Q(b)!=
Q(g)||1==h.comparePoints(b,c,g,n))g=b,n=c;d(a,b,c,g,n)}}function m(a,b,c){var g=a.startContainer,n=a.startOffset;if(b!==a.endContainer||c!==a.endOffset){if(Q(b)!=Q(g)||-1==h.comparePoints(b,c,g,n))g=b,n=c;d(a,g,n,b,c)}}a.prototype=new K;c.util.extend(a.prototype,{setStart:function(a,b){p(this);y(a,!0);D(a,b);o(this,a,b)},setEnd:function(a,b){p(this);y(a,!0);D(a,b);m(this,a,b)},setStartBefore:f(!0,!0),setStartAfter:f(!1,!0),setEndBefore:f(!0,!1),setEndAfter:f(!1,!1),collapse:function(a){t(this);a?
d(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):d(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){p(this);y(a,!0);d(this,a,0,a,h.getNodeLength(a))},selectNode:function(a){p(this);y(a,!1);B(a,I);var b=g(a),a=e(a);d(this,b.node,b.offset,a.node,a.offset)},extractContents:M(i,d),deleteContents:M(l,d),canSurroundContents:function(){t(this);z(this.startContainer);z(this.endContainer);var a=new q(this,!0),d=a._first&&
b(a._first,this)||a._last&&b(a._last,this);a.detach();return!d},detach:function(){n(this)},splitBoundaries:function(){t(this);var a=this.startContainer,b=this.startOffset,c=this.endContainer,g=this.endOffset,n=a===c;h.isCharacterDataNode(c)&&(0<g&&g<c.length)&&h.splitDataNode(c,g);h.isCharacterDataNode(a)&&(0<b&&b<a.length)&&(a=h.splitDataNode(a,b),n?(g-=b,c=a):c==a.parentNode&&g>=h.getNodeIndex(a)&&g++,b=0);d(this,a,b,c,g)},normalizeBoundaries:function(){t(this);var a=this.startContainer,b=this.startOffset,
c=this.endContainer,g=this.endOffset,n=function(a){var b=a.nextSibling;b&&b.nodeType==a.nodeType&&(c=a,g=a.length,a.appendData(b.data),b.parentNode.removeChild(b))},e=function(d){var n=d.previousSibling;if(n&&n.nodeType==d.nodeType){a=d;var e=d.length;b=n.length;d.insertData(0,n.data);n.parentNode.removeChild(n);a==c?(g+=b,c=a):c==d.parentNode&&(n=h.getNodeIndex(d),g==n?(c=d,g=e):g>n&&g--)}},O=!0;h.isCharacterDataNode(c)?c.length==g&&n(c):(0<g&&(O=c.childNodes[g-1])&&h.isCharacterDataNode(O)&&n(O),
O=!this.collapsed);O?h.isCharacterDataNode(a)?0==b&&e(a):b<a.childNodes.length&&(n=a.childNodes[b])&&h.isCharacterDataNode(n)&&e(n):(a=c,b=g);d(this,a,b,c,g)},collapseToPoint:function(a,b){p(this);y(a,!0);D(a,b);(a!==this.startContainer||b!==this.startOffset||a!==this.endContainer||b!==this.endOffset)&&d(this,a,b,a,b)}});E(a)}function N(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset;a.commonAncestorContainer=a.collapsed?a.startContainer:h.getCommonAncestor(a.startContainer,
a.endContainer)}function R(a,b,c,g,n){var e=a.startContainer!==b||a.startOffset!==c,f=a.endContainer!==g||a.endOffset!==n;a.startContainer=b;a.startOffset=c;a.endContainer=g;a.endOffset=n;N(a);d(a,"boundarychange",{startMoved:e,endMoved:f})}function v(a){this.startContainer=a;this.startOffset=0;this.endContainer=a;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};N(this)}c.requireModules(["DomUtil"]);var h=c.dom,H=h.DomPosition,A=c.DOMException;q.prototype={_current:null,_next:null,_first:null,
_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;a&&(this._next=a!==this._last?a.nextSibling:null,h.isCharacterDataNode(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so)));return a},remove:function(){var a=this._current,b,d;h.isCharacterDataNode(a)&&
(a===this.sc||a===this.ec)?(b=a===this.sc?this.so:0,d=a===this.ec?this.eo:a.length,b!=d&&a.deleteData(b,d-b)):a.parentNode&&a.parentNode.removeChild(a)},isPartiallySelectedSubtree:function(){return b(this._current,this.range)},getSubtreeIterator:function(){var b;if(this.isSingleCharacterDataNode)b=this.range.cloneRange(),b.collapse();else{b=new v(a(this.range));var d=this._current,c=d,g=0,n=d,e=h.getNodeLength(d);h.isAncestorOf(d,this.sc,!0)&&(c=this.sc,g=this.so);h.isAncestorOf(d,this.ec,!0)&&(n=
this.ec,e=this.eo);R(b,c,g,n,e)}return new q(b,this.clonePartiallySelectedTextNodes)},detach:function(a){a&&this.range.detach();this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};u.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};u.prototype.toString=function(){return this.message};m.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},
detach:function(){this._current=this._next=this.nodes=null}};var I=[1,3,4,5,7,8,10],L=[2,9,11],J=[1,3,4,5,7,8,10,11],n=[1,3,4,5,7,8],Q=h.getRootContainer,S=s([9,11]),da=s([5,6,10,12]),ca=s([6,10,12]),ba=document.createElement("style"),V=!1;try{ba.innerHTML="<b>x</b>",V=3==ba.firstChild.nodeType}catch(fa){}c.features.htmlParsingConforms=V;var W="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" "),T=0,X=1,ea=2,Y=3,Z=0,$=1,aa=2,U=3;K.prototype={attachListener:function(a,
b){this._listeners[a].push(b)},compareBoundaryPoints:function(a,b){t(this);C(this.startContainer,b.startContainer);var d=a==Y||a==T?"start":"end",c=a==X||a==T?"start":"end";return h.comparePoints(this[d+"Container"],this[d+"Offset"],b[c+"Container"],b[c+"Offset"])},insertNode:function(a){t(this);B(a,J);z(this.startContainer);if(h.isAncestorOf(a,this.startContainer,!0))throw new A("HIERARCHY_REQUEST_ERR");this.setStartBefore(f(a,this.startContainer,this.startOffset))},cloneContents:function(){t(this);
var b,d;if(this.collapsed)return a(this).createDocumentFragment();if(this.startContainer===this.endContainer&&h.isCharacterDataNode(this.startContainer))return b=this.startContainer.cloneNode(!0),b.data=b.data.slice(this.startOffset,this.endOffset),d=a(this).createDocumentFragment(),d.appendChild(b),d;d=new q(this,!0);b=k(d);d.detach();return b},canSurroundContents:function(){t(this);z(this.startContainer);z(this.endContainer);var a=new q(this,!0),d=a._first&&b(a._first,this)||a._last&&b(a._last,
this);a.detach();return!d},surroundContents:function(a){B(a,n);if(!this.canSurroundContents())throw new u("BAD_BOUNDARYPOINTS_ERR");var b=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);f(a,this.startContainer,this.startOffset);a.appendChild(b);this.selectNode(a)},cloneRange:function(){t(this);for(var b=new v(a(this)),d=W.length,c;d--;)c=W[d],b[c]=this[c];return b},toString:function(){t(this);var a=this.startContainer;if(a===this.endContainer&&h.isCharacterDataNode(a))return 3==
a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var b=[],a=new q(this,!0);o(a,function(a){(3==a.nodeType||4==a.nodeType)&&b.push(a.data)});a.detach();return b.join("")},compareNode:function(a){t(this);var b=a.parentNode,d=h.getNodeIndex(a);if(!b)throw new A("NOT_FOUND_ERR");a=this.comparePoint(b,d);b=this.comparePoint(b,d+1);return 0>a?0<b?aa:Z:0<b?$:U},comparePoint:function(a,b){t(this);w(a,"HIERARCHY_REQUEST_ERR");C(a,this.startContainer);return 0>h.comparePoints(a,b,
this.startContainer,this.startOffset)?-1:0<h.comparePoints(a,b,this.endContainer,this.endOffset)?1:0},createContextualFragment:V?function(a){var b=this.startContainer,d=h.getDocument(b);if(!b)throw new A("INVALID_STATE_ERR");var c=null;1==b.nodeType?c=b:h.isCharacterDataNode(b)&&(c=h.parentElement(b));c=null===c||"HTML"==c.nodeName&&h.isHtmlNamespace(h.getDocument(c).documentElement)&&h.isHtmlNamespace(c)?d.createElement("body"):c.cloneNode(!1);c.innerHTML=a;return h.fragmentFromNodeChildren(c)}:
function(b){p(this);var d=a(this).createElement("body");d.innerHTML=b;return h.fragmentFromNodeChildren(d)},toHtml:function(){t(this);var b=a(this).createElement("div");b.appendChild(this.cloneContents());return b.innerHTML},intersectsNode:function(b,d){t(this);w(b,"NOT_FOUND_ERR");if(h.getDocument(b)!==a(this))return!1;var c=b.parentNode,g=h.getNodeIndex(b);w(c,"NOT_FOUND_ERR");var n=h.comparePoints(c,g,this.endContainer,this.endOffset),c=h.comparePoints(c,g+1,this.startContainer,this.startOffset);
return d?0>=n&&0<=c:0>n&&0<c},isPointInRange:function(a,b){t(this);w(a,"HIERARCHY_REQUEST_ERR");C(a,this.startContainer);return 0<=h.comparePoints(a,b,this.startContainer,this.startOffset)&&0>=h.comparePoints(a,b,this.endContainer,this.endOffset)},intersectsRange:function(b,d){t(this);if(a(b)!=a(this))throw new A("WRONG_DOCUMENT_ERR");var c=h.comparePoints(this.startContainer,this.startOffset,b.endContainer,b.endOffset),g=h.comparePoints(this.endContainer,this.endOffset,b.startContainer,b.startOffset);
return d?0>=c&&0<=g:0>c&&0<g},intersection:function(a){if(this.intersectsRange(a)){var b=h.comparePoints(this.startContainer,this.startOffset,a.startContainer,a.startOffset),d=h.comparePoints(this.endContainer,this.endOffset,a.endContainer,a.endOffset),c=this.cloneRange();-1==b&&c.setStart(a.startContainer,a.startOffset);1==d&&c.setEnd(a.endContainer,a.endOffset);return c}return null},union:function(a){if(this.intersectsRange(a,!0)){var b=this.cloneRange();-1==h.comparePoints(a.startContainer,a.startOffset,
this.startContainer,this.startOffset)&&b.setStart(a.startContainer,a.startOffset);1==h.comparePoints(a.endContainer,a.endOffset,this.endContainer,this.endOffset)&&b.setEnd(a.endContainer,a.endOffset);return b}throw new u("Ranges do not intersect");},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==U},containsNodeContents:function(a){return 0<=this.comparePoint(a,0)&&0>=this.comparePoint(a,h.getNodeLength(a))},containsRange:function(a){return this.intersection(a).equals(a)},
containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var d=b.getNodes([3]);return 0<d.length?(b.setStart(d[0],0),a=d.pop(),b.setEnd(a,a.length),a=this.containsRange(b),b.detach(),a):this.containsNodeContents(a)},createNodeIterator:function(a,b){t(this);return new m(this,a,b)},getNodes:function(a,b){t(this);return x(this,a,b)},getDocument:function(){return a(this)},collapseBefore:function(a){p(this);this.setEndBefore(a);this.collapse(!1)},collapseAfter:function(a){p(this);this.setStartAfter(a);
this.collapse(!0)},getName:function(){return"DomRange"},equals:function(a){return v.rangesEqual(this,a)},isValid:function(){return F(this)},inspect:function(){return r(this)}};P(v,R,function(a){p(a);a.startContainer=a.startOffset=a.endContainer=a.endOffset=null;a.collapsed=a.commonAncestorContainer=null;d(a,"detach",null);a._listeners=null});c.rangePrototype=K.prototype;v.rangeProperties=W;v.RangeIterator=q;v.copyComparisonConstants=E;v.createPrototypeRange=P;v.inspect=r;v.getRangeDocument=a;v.rangesEqual=
function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset};c.DomRange=v;c.RangeException=u});
rangy.createModule("WrappedRange",function(c){function b(a,b,d,c){var f=a.duplicate();f.collapse(d);var k=f.parentElement();g.isAncestorOf(b,k,!0)||(k=b);if(!k.canHaveHTML)return new e(k.parentNode,g.getNodeIndex(k));var b=g.getDocument(k).createElement("span"),u,m=d?"StartToStart":"StartToEnd";do k.insertBefore(b,b.previousSibling),f.moveToElementText(b);while(0<(u=f.compareEndPoints(m,a))&&b.previousSibling);m=b.nextSibling;if(-1==u&&m&&g.isCharacterDataNode(m)){f.setEndPoint(d?"EndToStart":"EndToEnd",
a);if(/[\r\n]/.test(m.data)){k=f.duplicate();d=k.text.replace(/\r\n/g,"\r").length;for(d=k.moveStart("character",d);-1==k.compareEndPoints("StartToEnd",k);)d++,k.moveStart("character",1)}else d=f.text.length;k=new e(m,d)}else m=(c||!d)&&b.previousSibling,k=(d=(c||d)&&b.nextSibling)&&g.isCharacterDataNode(d)?new e(d,0):m&&g.isCharacterDataNode(m)?new e(m,m.length):new e(k,g.getNodeIndex(b));b.parentNode.removeChild(b);return k}function a(a,b){var d,c,e=a.offset,f=g.getDocument(a.node),k=f.body.createTextRange(),
m=g.isCharacterDataNode(a.node);m?(d=a.node,c=d.parentNode):(d=a.node.childNodes,d=e<d.length?d[e]:null,c=a.node);f=f.createElement("span");f.innerHTML="&#feff;";d?c.insertBefore(f,d):c.appendChild(f);k.moveToElementText(f);k.collapse(!b);c.removeChild(f);if(m)k[b?"moveStart":"moveEnd"]("character",e);return k}c.requireModules(["DomUtil","DomRange"]);var d,g=c.dom,e=g.DomPosition,f=c.DomRange;if(c.features.implementsDomRange&&(!c.features.implementsTextRange||!c.config.preferTextRange))(function(){function a(b){for(var d=
e.length,c;d--;)c=e[d],b[c]=b.nativeRange[c]}var b,e=f.rangeProperties,k;d=function(b){if(!b)throw Error("Range must be specified");this.nativeRange=b;a(this)};f.createPrototypeRange(d,function(a,b,d,c,g){var e=a.endContainer!==c||a.endOffset!=g;if(a.startContainer!==b||a.startOffset!=d||e)a.setEnd(c,g),a.setStart(b,d)},function(a){a.nativeRange.detach();a.detached=!0;for(var b=e.length,d;b--;)d=e[b],a[d]=null});b=d.prototype;b.selectNode=function(b){this.nativeRange.selectNode(b);a(this)};b.deleteContents=
function(){this.nativeRange.deleteContents();a(this)};b.extractContents=function(){var b=this.nativeRange.extractContents();a(this);return b};b.cloneContents=function(){return this.nativeRange.cloneContents()};b.surroundContents=function(b){this.nativeRange.surroundContents(b);a(this)};b.collapse=function(b){this.nativeRange.collapse(b);a(this)};b.cloneRange=function(){return new d(this.nativeRange.cloneRange())};b.refresh=function(){a(this)};b.toString=function(){return this.nativeRange.toString()};
var r=document.createTextNode("test");g.getBody(document).appendChild(r);var q=document.createRange();q.setStart(r,0);q.setEnd(r,0);try{q.setStart(r,1),b.setStart=function(b,d){this.nativeRange.setStart(b,d);a(this)},b.setEnd=function(b,d){this.nativeRange.setEnd(b,d);a(this)},k=function(b){return function(d){this.nativeRange[b](d);a(this)}}}catch(u){b.setStart=function(b,d){try{this.nativeRange.setStart(b,d)}catch(c){this.nativeRange.setEnd(b,d),this.nativeRange.setStart(b,d)}a(this)},b.setEnd=function(b,
d){try{this.nativeRange.setEnd(b,d)}catch(c){this.nativeRange.setStart(b,d),this.nativeRange.setEnd(b,d)}a(this)},k=function(b,d){return function(c){try{this.nativeRange[b](c)}catch(g){this.nativeRange[d](c),this.nativeRange[b](c)}a(this)}}}b.setStartBefore=k("setStartBefore","setEndBefore");b.setStartAfter=k("setStartAfter","setEndAfter");b.setEndBefore=k("setEndBefore","setStartBefore");b.setEndAfter=k("setEndAfter","setStartAfter");q.selectNodeContents(r);b.selectNodeContents=q.startContainer==
r&&q.endContainer==r&&0==q.startOffset&&q.endOffset==r.length?function(b){this.nativeRange.selectNodeContents(b);a(this)}:function(a){this.setStart(a,0);this.setEnd(a,f.getEndOffset(a))};q.selectNodeContents(r);q.setEnd(r,3);k=document.createRange();k.selectNodeContents(r);k.setEnd(r,4);k.setStart(r,2);b.compareBoundaryPoints=-1==q.compareBoundaryPoints(q.START_TO_END,k)&1==q.compareBoundaryPoints(q.END_TO_START,k)?function(a,b){b=b.nativeRange||b;a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&
(a=b.START_TO_END);return this.nativeRange.compareBoundaryPoints(a,b)}:function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)};c.util.isHostMethod(q,"createContextualFragment")&&(b.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)});g.getBody(document).removeChild(r);q.detach();k.detach()})(),c.createNativeRange=function(a){a=a||document;return a.createRange()};else if(c.features.implementsTextRange){d=function(a){this.textRange=a;this.refresh()};
d.prototype=new f(document);d.prototype.refresh=function(){var a,d,c=this.textRange;a=c.parentElement();var e=c.duplicate();e.collapse(!0);d=e.parentElement();e=c.duplicate();e.collapse(!1);c=e.parentElement();d=d==c?d:g.getCommonAncestor(d,c);d=d==a?d:g.getCommonAncestor(a,d);0==this.textRange.compareEndPoints("StartToEnd",this.textRange)?d=a=b(this.textRange,d,!0,!0):(a=b(this.textRange,d,!0,!1),d=b(this.textRange,d,!1,!1));this.setStart(a.node,a.offset);this.setEnd(d.node,d.offset)};f.copyComparisonConstants(d);
var k=function(){return this}();"undefined"==typeof k.Range&&(k.Range=d);c.createNativeRange=function(a){a=a||document;return a.body.createTextRange()}}c.features.implementsTextRange&&(d.rangeToTextRange=function(b){if(b.collapsed)return a(new e(b.startContainer,b.startOffset),!0);var d=a(new e(b.startContainer,b.startOffset),!0),c=a(new e(b.endContainer,b.endOffset),!1),b=g.getDocument(b.startContainer).body.createTextRange();b.setEndPoint("StartToStart",d);b.setEndPoint("EndToEnd",c);return b});
d.prototype.getName=function(){return"WrappedRange"};c.WrappedRange=d;c.createRange=function(a){a=a||document;return new d(c.createNativeRange(a))};c.createRangyRange=function(a){a=a||document;return new f(a)};c.createIframeRange=function(a){return c.createRange(g.getIframeDocument(a))};c.createIframeRangyRange=function(a){return c.createRangyRange(g.getIframeDocument(a))};c.addCreateMissingNativeApiListener(function(a){a=a.document;if(typeof a.createRange=="undefined")a.createRange=function(){return c.createRange(this)};
a=a=null})});
rangy.createModule("WrappedSelection",function(c,b){function a(a){return(a||window).getSelection()}function d(a){return(a||window).document.selection}function g(a,b,d){var c=d?"end":"start",d=d?"start":"end";a.anchorNode=b[c+"Container"];a.anchorOffset=b[c+"Offset"];a.focusNode=b[d+"Container"];a.focusOffset=b[d+"Offset"]}function e(a){a.anchorNode=a.focusNode=null;a.anchorOffset=a.focusOffset=0;a.rangeCount=0;a.isCollapsed=!0;a._ranges.length=0}function f(a){var b;a instanceof y?(b=a._selectionNativeRange,
b||(b=c.createNativeRange(m.getDocument(a.startContainer)),b.setEnd(a.endContainer,a.endOffset),b.setStart(a.startContainer,a.startOffset),a._selectionNativeRange=b,a.attachListener("detach",function(){this._selectionNativeRange=null}))):a instanceof p?b=a.nativeRange:c.features.implementsDomRange&&a instanceof m.getWindow(a.startContainer).Range&&(b=a);return b}function k(a){var b=a.getNodes(),d;a:if(!b.length||1!=b[0].nodeType)d=!1;else{d=1;for(var c=b.length;d<c;++d)if(!m.isAncestorOf(b[0],b[d])){d=
!1;break a}d=!0}if(!d)throw Error("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return b[0]}function o(a,b){var d=new p(b);a._ranges=[d];g(a,d,!1);a.rangeCount=1;a.isCollapsed=d.collapsed}function l(a){a._ranges.length=0;if("None"==a.docSelection.type)e(a);else{var b=a.docSelection.createRange();if(b&&"undefined"!=typeof b.text)o(a,b);else{a.rangeCount=b.length;for(var d,f=m.getDocument(b.item(0)),k=0;k<a.rangeCount;++k)d=c.createRange(f),d.selectNode(b.item(k)),
a._ranges.push(d);a.isCollapsed=1==a.rangeCount&&a._ranges[0].collapsed;g(a,a._ranges[a.rangeCount-1],!1)}}}function i(a,b){for(var d=a.docSelection.createRange(),c=k(b),g=m.getDocument(d.item(0)),g=m.getBody(g).createControlRange(),e=0,f=d.length;e<f;++e)g.add(d.item(e));try{g.add(c)}catch(h){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}g.select();l(a)}function x(a,b,d){this.nativeSelection=a;this.docSelection=b;this._ranges=
[];this.win=d;this.refresh()}function r(a,b){for(var d=m.getDocument(b[0].startContainer),d=m.getBody(d).createControlRange(),c=0,g;c<rangeCount;++c){g=k(b[c]);try{d.add(g)}catch(e){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)");}}d.select();l(a)}function q(a,b){if(a.anchorNode&&m.getDocument(a.anchorNode)!==m.getDocument(b))throw new B("WRONG_DOCUMENT_ERR");}function u(a){var b=[],d=new D(a.anchorNode,a.anchorOffset),
c=new D(a.focusNode,a.focusOffset),g="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var e=0,f=a.rangeCount;e<f;++e)b[e]=y.inspect(a.getRangeAt(e));return"["+g+"(Ranges: "+b.join(", ")+")(anchor: "+d.inspect()+", focus: "+c.inspect()+"]"}c.requireModules(["DomUtil","DomRange","WrappedRange"]);c.config.checkSelectionRanges=!0;var m=c.dom,s=c.util,y=c.DomRange,p=c.WrappedRange,B=c.DOMException,D=m.DomPosition,C,z,w=c.util.isHostMethod(window,"getSelection"),
F=c.util.isHostObject(document,"selection"),t=F&&(!w||c.config.preferTextRange);t?(C=d,c.isSelectionValid=function(a){var a=(a||window).document,b=a.selection;return"None"!=b.type||m.getDocument(b.createRange().parentElement())==a}):w?(C=a,c.isSelectionValid=function(){return!0}):b.fail("Neither document.selection or window.getSelection() detected.");c.getNativeSelection=C;var w=C(),K=c.createNativeRange(document),G=m.getBody(document),E=s.areHostObjects(w,s.areHostProperties(w,["anchorOffset","focusOffset"]));
c.features.selectionHasAnchorAndFocus=E;var M=s.isHostMethod(w,"extend");c.features.selectionHasExtend=M;var P="number"==typeof w.rangeCount;c.features.selectionHasRangeCount=P;var N=!1,R=!0;s.areHostMethods(w,["addRange","getRangeAt","removeAllRanges"])&&("number"==typeof w.rangeCount&&c.features.implementsDomRange)&&function(){var a=document.createElement("iframe");a.frameBorder=0;a.style.position="absolute";a.style.left="-10000px";G.appendChild(a);var b=m.getIframeDocument(a);b.open();b.write("<html><head></head><body>12</body></html>");
b.close();var d=m.getIframeWindow(a).getSelection(),c=b.documentElement.lastChild.firstChild,b=b.createRange();b.setStart(c,1);b.collapse(true);d.addRange(b);R=d.rangeCount==1;d.removeAllRanges();var g=b.cloneRange();b.setStart(c,0);g.setEnd(c,2);d.addRange(b);d.addRange(g);N=d.rangeCount==2;b.detach();g.detach();G.removeChild(a)}();c.features.selectionSupportsMultipleRanges=N;c.features.collapsedNonEditableSelectionsSupported=R;var v=!1,h;G&&s.isHostMethod(G,"createControlRange")&&(h=G.createControlRange(),
s.areHostProperties(h,["item","add"])&&(v=!0));c.features.implementsControlRange=v;z=E?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:false};var H;s.isHostMethod(w,"getRangeAt")?H=function(a,b){try{return a.getRangeAt(b)}catch(d){return null}}:E&&(H=function(a){var b=m.getDocument(a.anchorNode),b=c.createRange(b);b.setStart(a.anchorNode,a.anchorOffset);b.setEnd(a.focusNode,a.focusOffset);if(b.collapsed!==
this.isCollapsed){b.setStart(a.focusNode,a.focusOffset);b.setEnd(a.anchorNode,a.anchorOffset)}return b});c.getSelection=function(a){var a=a||window,b=a._rangySelection,c=C(a),g=F?d(a):null;if(b){b.nativeSelection=c;b.docSelection=g;b.refresh(a)}else{b=new x(c,g,a);a._rangySelection=b}return b};c.getIframeSelection=function(a){return c.getSelection(m.getIframeWindow(a))};h=x.prototype;if(!t&&E&&s.areHostMethods(w,["removeAllRanges","addRange"])){h.removeAllRanges=function(){this.nativeSelection.removeAllRanges();
e(this)};var A=function(a,b){var d=y.getRangeDocument(b),d=c.createRange(d);d.collapseToPoint(b.endContainer,b.endOffset);a.nativeSelection.addRange(f(d));a.nativeSelection.extend(b.startContainer,b.startOffset);a.refresh()};h.addRange=P?function(a,b){if(v&&F&&this.docSelection.type=="Control")i(this,a);else if(b&&M)A(this,a);else{var d;if(N)d=this.rangeCount;else{this.removeAllRanges();d=0}this.nativeSelection.addRange(f(a));this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==d+1){if(c.config.checkSelectionRanges)(d=
H(this.nativeSelection,this.rangeCount-1))&&!y.rangesEqual(d,a)&&(a=new p(d));this._ranges[this.rangeCount-1]=a;g(this,a,J(this.nativeSelection));this.isCollapsed=z(this)}else this.refresh()}}:function(a,b){if(b&&M)A(this,a);else{this.nativeSelection.addRange(f(a));this.refresh()}};h.setRanges=function(a){if(v&&a.length>1)r(this,a);else{this.removeAllRanges();for(var b=0,d=a.length;b<d;++b)this.addRange(a[b])}}}else if(s.isHostMethod(w,"empty")&&s.isHostMethod(K,"select")&&v&&t)h.removeAllRanges=
function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var a;if(this.anchorNode)a=m.getDocument(this.anchorNode);else if(this.docSelection.type=="Control"){var b=this.docSelection.createRange();b.length&&(a=m.getDocument(b.item(0)).body.createTextRange())}if(a){a.body.createTextRange().select();this.docSelection.empty()}}}catch(d){}e(this)},h.addRange=function(a){if(this.docSelection.type=="Control")i(this,a);else{p.rangeToTextRange(a).select();this._ranges[0]=a;this.rangeCount=
1;this.isCollapsed=this._ranges[0].collapsed;g(this,a,false)}},h.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?r(this,a):b&&this.addRange(a[0])};else return b.fail("No means of selecting a Range or TextRange was found"),!1;h.getRangeAt=function(a){if(a<0||a>=this.rangeCount)throw new B("INDEX_SIZE_ERR");return this._ranges[a]};var I;if(t)I=function(a){var b;if(c.isSelectionValid(a.win))b=a.docSelection.createRange();else{b=m.getBody(a.win.document).createTextRange();b.collapse(true)}a.docSelection.type==
"Control"?l(a):b&&typeof b.text!="undefined"?o(a,b):e(a)};else if(s.isHostMethod(w,"getRangeAt")&&"number"==typeof w.rangeCount)I=function(a){if(v&&F&&a.docSelection.type=="Control")l(a);else{a._ranges.length=a.rangeCount=a.nativeSelection.rangeCount;if(a.rangeCount){for(var b=0,d=a.rangeCount;b<d;++b)a._ranges[b]=new c.WrappedRange(a.nativeSelection.getRangeAt(b));g(a,a._ranges[a.rangeCount-1],J(a.nativeSelection));a.isCollapsed=z(a)}else e(a)}};else if(E&&"boolean"==typeof w.isCollapsed&&"boolean"==
typeof K.collapsed&&c.features.implementsDomRange)I=function(a){var b;b=a.nativeSelection;if(b.anchorNode){b=H(b,0);a._ranges=[b];a.rangeCount=1;b=a.nativeSelection;a.anchorNode=b.anchorNode;a.anchorOffset=b.anchorOffset;a.focusNode=b.focusNode;a.focusOffset=b.focusOffset;a.isCollapsed=z(a)}else e(a)};else return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;h.refresh=function(a){var b=a?this._ranges.slice(0):null;I(this);if(a){a=b.length;if(a!=this._ranges.length)return false;
for(;a--;)if(!y.rangesEqual(b[a],this._ranges[a]))return false;return true}};var L=function(a,b){var d=a.getAllRanges(),c=false;a.removeAllRanges();for(var g=0,f=d.length;g<f;++g)c||b!==d[g]?a.addRange(d[g]):c=true;a.rangeCount||e(a)};h.removeRange=v?function(a){if(this.docSelection.type=="Control"){for(var b=this.docSelection.createRange(),a=k(a),d=m.getDocument(b.item(0)),d=m.getBody(d).createControlRange(),c,g=false,e=0,f=b.length;e<f;++e){c=b.item(e);c!==a||g?d.add(b.item(e)):g=true}d.select();
l(this)}else L(this,a)}:function(a){L(this,a)};var J;!t&&E&&c.features.implementsDomRange?(J=function(a){var b=false;a.anchorNode&&(b=m.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)==1);return b},h.isBackwards=function(){return J(this)}):J=h.isBackwards=function(){return false};h.toString=function(){for(var a=[],b=0,d=this.rangeCount;b<d;++b)a[b]=""+this._ranges[b];return a.join("")};h.collapse=function(a,b){q(this,a);var d=c.createRange(m.getDocument(a));d.collapseToPoint(a,
b);this.removeAllRanges();this.addRange(d);this.isCollapsed=true};h.collapseToStart=function(){if(this.rangeCount){var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)}else throw new B("INVALID_STATE_ERR");};h.collapseToEnd=function(){if(this.rangeCount){var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)}else throw new B("INVALID_STATE_ERR");};h.selectAllChildren=function(a){q(this,a);var b=c.createRange(m.getDocument(a));b.selectNodeContents(a);this.removeAllRanges();
this.addRange(b)};h.deleteFromDocument=function(){if(v&&F&&this.docSelection.type=="Control"){for(var a=this.docSelection.createRange(),b;a.length;){b=a.item(0);a.remove(b);b.parentNode.removeChild(b)}this.refresh()}else if(this.rangeCount){a=this.getAllRanges();this.removeAllRanges();b=0;for(var d=a.length;b<d;++b)a[b].deleteContents();this.addRange(a[d-1])}};h.getAllRanges=function(){return this._ranges.slice(0)};h.setSingleRange=function(a){this.setRanges([a])};h.containsNode=function(a,b){for(var d=
0,c=this._ranges.length;d<c;++d)if(this._ranges[d].containsNode(a,b))return true;return false};h.toHtml=function(){var a="";if(this.rangeCount){for(var a=y.getRangeDocument(this._ranges[0]).createElement("div"),b=0,d=this._ranges.length;b<d;++b)a.appendChild(this._ranges[b].cloneContents());a=a.innerHTML}return a};h.getName=function(){return"WrappedSelection"};h.inspect=function(){return u(this)};h.detach=function(){this.win=this.anchorNode=this.focusNode=this.win._rangySelection=null};x.inspect=
u;c.Selection=x;c.selectionPrototype=h;c.addCreateMissingNativeApiListener(function(a){if(typeof a.getSelection=="undefined")a.getSelection=function(){return c.getSelection(this)};a=null})});"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});"indexOf"in Array.prototype||(Array.prototype.indexOf=function(c,b){b===void 0&&(b=0);b<0&&(b=b+this.length);b<0&&(b=0);for(var a=this.length;b<a;b++)if(b in this&&this[b]===c)return b;return-1});
"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(c,b){b===void 0&&(b=this.length-1);b<0&&(b=b+this.length);b>this.length-1&&(b=this.length-1);for(b++;b-- >0;)if(b in this&&this[b]===c)return b;return-1});"map"in Array.prototype||(Array.prototype.map=function(c,b){for(var a=Array(this.length),d=0,g=this.length;d<g;d++)d in this&&(a[d]=c.call(b,this[d],d,this));return a});
"filter"in Array.prototype||(Array.prototype.filter=function(c,b){for(var a=[],d,g=0,e=this.length;g<e;g++)g in this&&c.call(b,d=this[g],g,this)&&a.push(d);return a});
(function(){var c,b;c={changeIdAttribute:"data-cid",userIdAttribute:"data-userid",userNameAttribute:"data-username",timeAttribute:"data-time",attrValuePrefix:"",blockEl:"p",blockEls:["p","ol","ul","li","h1","h2","h3","h4","h5","h6","blockquote"],stylePrefix:"cts",currentUser:{id:null,name:null},changeTypes:{insertType:{tag:"span",alias:"ins",action:"Inserted"},deleteType:{tag:"span",alias:"del",action:"Deleted"}},handleEvents:false,contentEditable:void 0,isTracking:true,noTrack:".ice-no-track",avoid:".ice-avoid",
mergeBlocks:true};b=function(a){this._changes={};a||(a={});if(!a.element)throw Error("`options.element` must be defined for ice construction.");ice.dom.extend(true,this,c,a);this.pluginsManager=new ice.IcePluginManager(this);a.plugins&&this.pluginsManager.usePlugins("ice-init",a.plugins)};b.prototype={_userStyles:{},_styles:{},_uniqueStyleIndex:0,_browserType:null,_batchChangeid:null,_uniqueIDIndex:1,_delBookmark:"tempdel",isPlaceHoldingDeletes:false,startTracking:function(){typeof this.contentEditable==
"boolean"&&this.element.setAttribute("contentEditable",this.contentEditable);if(this.handleEvents){var a=this;ice.dom.bind(a.element,"keyup.ice keydown.ice keypress.ice mousedown.ice mouseup.ice",function(b){return a.handleEvent(b)})}this.initializeEnvironment();this.initializeEditor();this.initializeRange();this.pluginsManager.fireEnabled(this.element);return this},stopTracking:function(a){this.element&&ice.dom.unbind(this.element,"keyup.ice keydown.ice keypress.ice mousedown.ice mouseup.ice");if(!a){this.element.setAttribute("contentEditable",
!this.contentEditable);this.pluginsManager.fireDisabled(this.element);return this}},initializeEnvironment:function(){this.env||(this.env={});this.env.element=this.element;this.env.document=this.element.ownerDocument;this.env.window=this.env.document.defaultView||this.env.document.parentWindow||window;this.env.frame=this.env.window.frameElement;this.env.selection=this.selection=new ice.Selection(this.env);this.env.document.createElement(this.changeTypes.insertType.tag);this.env.document.createElement(this.changeTypes.deleteType.tag)},
initializeRange:function(){var a=this.selection.createRange();a.setStart(ice.dom.find(this.element,this.blockEls.join(", "))[0],0);a.collapse(true);this.selection.addRange(a);this.env.frame?this.env.frame.contentWindow.focus():this.element.focus()},initializeEditor:function(){var a=this,b=this.env.document.createElement("div");if(this.element.childNodes.length){b.innerHTML=this.element.innerHTML;ice.dom.removeWhitespace(b);b.innerHTML===""&&b.appendChild(ice.dom.create("<"+this.blockEl+" ><br/></"+
this.blockEl+">"))}else b.appendChild(ice.dom.create("<"+this.blockEl+" ><br/></"+this.blockEl+">"));this.element.innerHTML=b.innerHTML;var c=[],e;for(e in this.changeTypes)c.push(this._getIceNodeClass(e));ice.dom.each(ice.dom.find(this.element,"."+c.join(", .")),function(b,d){for(var e=0,l="",i=d.className.split(" "),b=0;b<i.length;b++){var x=RegExp(a.stylePrefix+"-(\\d+)").exec(i[b]);x&&(e=x[1]);(x=RegExp("("+c.join("|")+")").exec(i[b]))&&(l=a._getChangeTypeFromAlias(x[1]))}i=ice.dom.attr(d,a.userIdAttribute);
a.setUserStyle(i,Number(e));e=ice.dom.attr(d,a.changeIdAttribute);a._changes[e]={type:l,userid:i,username:ice.dom.attr(d,a.userNameAttribute),time:ice.dom.attr(d,a.timeAttribute)}})},enableChangeTracking:function(){this.isTracking=true;this.pluginsManager.fireEnabled(this.element)},disableChangeTracking:function(){this.isTracking=false;this.pluginsManager.fireDisabled(this.element)},setCurrentUser:function(a){this.currentUser=a},handleEvent:function(a){if(this.isTracking)if(a.type=="mouseup"){var b=
this;setTimeout(function(){b.mouseUp(a)},200)}else{if(a.type=="mousedown")return this.mouseDown(a);if(a.type=="keypress"){var c=this.keyPress(a);c||a.preventDefault();return c}if(a.type=="keydown"){(c=this.keyDown(a))||a.preventDefault();return c}a.type=="keyup"&&this.pluginsManager.fireCaretUpdated()}},createIceNode:function(a,b){var c=this.env.document.createElement(this.changeTypes[a].tag);ice.dom.addClass(c,this._getIceNodeClass(a));c.appendChild(b?b:this.env.document.createTextNode(""));this.addChange(this.changeTypes[a].alias,
[c]);this.pluginsManager.fireNodeCreated(c,{action:this.changeTypes[a].action});return c},insert:function(a,b){b?this.selection.addRange(b):b=this.getCurrentRange();typeof a==="string"&&(a=document.createTextNode(a));if(!b.collapsed){this.deleteContents();b=this.getCurrentRange();if(b.startContainer===b.endContainer&&this.element===b.startContainer){ice.dom.empty(this.element);var c=b.getLastSelectableChild(this.element);b.setStartAfter(c);b.collapse(true)}}this._moveRangeToValidTrackingPos(b);c=
this.startBatchChange();this._insertNode(a||document.createTextNode("﻿"),b,!a);this.pluginsManager.fireNodeInserted(a,b);this.endBatchChange(c);return false},placeholdDeletes:function(){var a=this;this.isPlaceholdingDeletes&&this.revertDeletePlaceholders();this.isPlaceholdingDeletes=true;this._deletes=[];var b="."+this._getIceNodeClass("deleteType");ice.dom.each(ice.dom.find(this.element,b),function(b,d){a._deletes.push(ice.dom.cloneNode(d));ice.dom.replaceWith(d,"<"+a._delBookmark+' data-allocation="'+
(a._deletes.length-1)+'"/>')});return true},revertDeletePlaceholders:function(){var a=this;if(!this.isPlaceholdingDeletes)return false;ice.dom.each(this._deletes,function(b,c){ice.dom.find(a.element,a._delBookmark+"[data-allocation="+b+"]").replaceWith(c)});this.isPlaceholdingDeletes=false;return true},deleteContents:function(a,b){var c=true;b?this.selection.addRange(b):b=this.getCurrentRange();var e=this.startBatchChange(this.changeTypes.deleteType.alias);b.collapsed===false?this._deleteSelection(b):
c=a?this._deleteRight(b):this._deleteLeft(b);this.selection.addRange(b);this.endBatchChange(e);return c},getChanges:function(){return this._changes},getChangeUserids:function(){var a=[],b=Object.keys(this._changes),c;for(c in b)a.push(this._changes[b[c]].userid);return a.sort().filter(function(a,b,d){return b==d.indexOf(a)?1:0})},getElementContent:function(){return this.element.innerHTML},getCleanContent:function(a,b,c){var e="",f=this;ice.dom.each(this.changeTypes,function(a,b){if(a!="deleteType"){b>
0&&(e=e+",");e=e+("."+f._getIceNodeClass(a))}});a=a?typeof a==="string"?ice.dom.create("<div>"+a+"</div>"):ice.dom.cloneNode(a,false)[0]:ice.dom.cloneNode(this.element,false)[0];a=c?c.call(this,a):a;c=ice.dom.find(a,e);ice.dom.each(c,function(){ice.dom.replaceWith(this,ice.dom.contents(this))});c=ice.dom.find(a,"."+this._getIceNodeClass("deleteType"));ice.dom.remove(c);a=b?b.call(this,a):a;return a.innerHTML},acceptAll:function(){this.element.innerHTML=this.getCleanContent()},rejectAll:function(){var a=
"."+this._getIceNodeClass("insertType"),b="."+this._getIceNodeClass("deleteType");ice.dom.remove(ice.dom.find(this.element,a));ice.dom.each(ice.dom.find(this.element,b),function(a,b){ice.dom.replaceWith(b,ice.dom.contents(b))})},acceptChange:function(a){this.acceptRejectChange(a,true)},rejectChange:function(a){this.acceptRejectChange(a,false)},acceptRejectChange:function(a,b){var c,e,f,k,o,l,i=ice.dom;if(!a){c=this.getCurrentRange();if(c.collapsed)a=c.startContainer;else return}c=f="."+this._getIceNodeClass("deleteType");
e=k="."+this._getIceNodeClass("insertType");o=i.getNode(a,c+","+e);l=i.find(this.element,"["+this.changeIdAttribute+"="+i.attr(o,this.changeIdAttribute)+"]");if(!b){f=e;k=c}ice.dom.is(o,k)?i.each(l,function(a,b){i.replaceWith(b,ice.dom.contents(b))}):i.is(o,f)&&i.remove(l)},isInsideChange:function(a){var b="."+this._getIceNodeClass("insertType")+", ."+this._getIceNodeClass("deleteType");if(!a){range=this.getCurrentRange();if(range.collapsed)a=range.startContainer;else return false}return!!ice.dom.getNode(a,
b)},addChangeType:function(a,b,c,e){b={tag:b,alias:c};if(e)b.action=e;this.changeTypes[a]=b},getIceNode:function(a,b){var c="."+this._getIceNodeClass(b);return ice.dom.getNode(a,c)},_moveRangeToValidTrackingPos:function(a){for(var b=false,c=this._getVoidElement(a.endContainer);c;){try{a.moveEnd(ice.dom.CHARACTER_UNIT,1);a.moveEnd(ice.dom.CHARACTER_UNIT,-1)}catch(e){b=true}if(b||ice.dom.onBlockBoundary(a.endContainer,a.startContainer,this.blockEls)){a.setStartAfter(c);a.collapse(true);break}if(c=this._getVoidElement(a.endContainer)){a.setEnd(a.endContainer,
0);a.moveEnd(ice.dom.CHARACTER_UNIT,ice.dom.getNodeCharacterLength(a.endContainer));a.collapse()}else{a.setStart(a.endContainer,0);a.collapse(true)}}},_getNoTrackElement:function(a){var b=this._getNoTrackSelector();return ice.dom.is(a,b)?a:ice.dom.parents(a,b)[0]||null},_getNoTrackSelector:function(){return this.noTrack},_getVoidElement:function(a){var b=this._getVoidElSelector();return ice.dom.is(a,b)?a:ice.dom.parents(a,b)[0]||null},_getVoidElSelector:function(){return"."+this._getIceNodeClass("deleteType")+
","+this.avoid},_currentUserIceNode:function(a){return ice.dom.attr(a,this.userIdAttribute)==this.currentUser.id},_getChangeTypeFromAlias:function(a){var b,c=null;for(b in this.changeTypes)this.changeTypes.hasOwnProperty(b)&&this.changeTypes[b].alias==a&&(c=b);return c},_getIceNodeClass:function(a){return this.attrValuePrefix+this.changeTypes[a].alias},getUserStyle:function(a){var b=null;return b=this._userStyles[a]?this._userStyles[a]:this.setUserStyle(a,this.getNewStyleId())},setUserStyle:function(a,
b){var c=this.stylePrefix+"-"+b;this._styles[b]||(this._styles[b]=true);return this._userStyles[a]=c},getNewStyleId:function(){var a=++this._uniqueStyleIndex;if(this._styles[a])return this.getNewStyleId();this._styles[a]=true;return a},addChange:function(a,b){var c=this._batchChangeid||this.getNewChangeId();this._changes[c]||(this._changes[c]={type:this._getChangeTypeFromAlias(a),time:(new Date).getTime(),userid:this.currentUser.id,username:this.currentUser.name});var e=this;ice.dom.foreach(b,function(a){e.addNodeToChange(c,
b[a])});return c},addNodeToChange:function(a,b){if(this._batchChangeid!==null)a=this._batchChangeid;var c=this.getChange(a);b.getAttribute(this.changeIdAttribute)||b.setAttribute(this.changeIdAttribute,a);b.getAttribute(this.userIdAttribute)||b.setAttribute(this.userIdAttribute,c.userid);b.getAttribute(this.userNameAttribute)||b.setAttribute(this.userNameAttribute,c.username);b.getAttribute(this.timeAttribute)||b.setAttribute(this.timeAttribute,c.time);ice.dom.hasClass(b,this._getIceNodeClass(c.type))||
ice.dom.addClass(b,this._getIceNodeClass(c.type));c=this.getUserStyle(c.userid);ice.dom.hasClass(b,c)||ice.dom.addClass(b,c)},getChange:function(a){var b=null;this._changes[a]&&(b=this._changes[a]);return b},getNewChangeId:function(){var a=++this._uniqueIDIndex;this._changes[a]&&(a=this.getNewChangeId());return a},startBatchChange:function(){return this._batchChangeid=this.getNewChangeId()},endBatchChange:function(a){if(a===this._batchChangeid)this._batchChangeid=null},getCurrentRange:function(){return this.selection.getRangeAt(0)},
_insertNode:function(a,b,c){!ice.dom.isBlockElement(b.startContainer)&&(!ice.dom.canContainTextElement(ice.dom.getBlockParent(b.startContainer,this.element))&&b.startContainer.previousSibling)&&b.setStart(b.startContainer.previousSibling,0);var e=ice.dom.isBlockElement(b.startContainer)&&b.startContainer||ice.dom.getBlockParent(b.startContainer,this.element)||null;if(e===this.element){var f=document.createElement(this.blockEl);e.appendChild(f);b.setStart(f,0);b.collapse();return this._insertNode(a,
b,c)}if(ice.dom.hasNoTextOrStubContent(e)){ice.dom.empty(e);ice.dom.append(e,"<br>");b.setStart(e,0)}e=this._currentUserIceNode(this.getIceNode(b.startContainer,"insertType"));if(!c||!e){e||(a=this.createIceNode("insertType",a));b.insertNode(a);b.setEnd(a,1);b.collapse();if(c){b.setStart(a,0);b.setEnd(a,1)}this.selection.addRange(b)}},_handleVoidEl:function(a,b){var c=this._getVoidElement(a);if(c&&!this.getIceNode(c,"deleteType")){b.collapse(true);return true}return false},_deleteSelection:function(a){for(var b=
new ice.Bookmark(this.env,a),c=ice.dom.getElementsBetween(b.start,b.end),e=ice.dom.parents(a.startContainer,this.blockEls.join(", "))[0],f=ice.dom.parents(a.endContainer,this.blockEls.join(", "))[0],k=[],o=0;o<c.length;o++){var l=c[o];if(ice.dom.isBlockElement(l)){k.push(l);if(!ice.dom.canContainTextElement(l)){for(var i=0;i<l.childNodes.length;i++)c.push(l.childNodes[i]);continue}}if(!(l.nodeType===ice.dom.TEXT_NODE&&ice.dom.getNodeTextContent(l).length===0)&&!this._getVoidElement(l))if(l.nodeType!==
ice.dom.TEXT_NODE)if(ice.dom.isStubElement(l))this._addNodeTracking(l,false,true);else{ice.dom.hasNoTextOrStubContent(l)&&ice.dom.remove(l);for(j=0;j<l.childNodes.length;j++)c.push(l.childNodes[j])}else{i=ice.dom.getBlockParent(l);this._addNodeTracking(l,false,true,true);ice.dom.hasNoTextOrStubContent(i)&&ice.dom.remove(i)}}if(this.mergeBlocks&&e!==f){for(;k.length;)ice.dom.mergeContainers(k.shift(),e);ice.dom.mergeContainers(f,e)}b.selectBookmark();a.collapse(false)},_deleteRight:function(a){var b=
ice.dom.isBlockElement(a.startContainer)&&a.startContainer||ice.dom.getBlockParent(a.startContainer,this.element)||null,c=b?ice.dom.hasNoTextOrStubContent(b):false,e=b&&ice.dom.getNextContentNode(b,this.element),f=e?ice.dom.hasNoTextOrStubContent(e):false,k=a.endContainer,o=a.endOffset,l=a.commonAncestorContainer,i;if(c)return false;if(l.nodeType!==ice.dom.TEXT_NODE){if(o===0&&ice.dom.isBlockElement(l)&&!ice.dom.canContainTextElement(l))if(b=l.firstElementChild){a.setStart(b,0);a.collapse();return this._deleteRight(a)}if(l.childNodes.length>
o){i=document.createTextNode(" ");l.insertBefore(i,l.childNodes[o]);a.setStart(i,1);a.collapse(true);b=this._deleteRight(a);ice.dom.remove(i);return b}i=ice.dom.getNextContentNode(l,this.element);a.setEnd(i,0);a.collapse();return this._deleteRight(a)}a.moveEnd(ice.dom.CHARACTER_UNIT,1);a.moveEnd(ice.dom.CHARACTER_UNIT,-1);if(o===k.data.length&&!ice.dom.hasNoTextOrStubContent(k)){i=ice.dom.getNextNode(k,this.element);if(!i){a.selectNodeContents(k);a.collapse();return false}if(i.nodeType===ice.dom.TEXT_NODE)i=
i.parentNode;if(!i.isContentEditable){b=this._addNodeTracking(i,false,false);o=document.createTextNode("");i.parentNode.insertBefore(o,i.nextSibling);a.selectNode(o);a.collapse(true);return b}if(this._handleVoidEl(i,a))return true;if(ice.dom.isChildOf(i,b)&&ice.dom.isStubElement(i))return this._addNodeTracking(i,a,false)}if(this._handleVoidEl(i,a))return true;if(this._getNoTrackElement(a.endContainer.parentElement)){a.deleteContents();return false}if(ice.dom.isOnBlockBoundary(a.startContainer,a.endContainer,
this.element)){if(this.mergeBlocks&&ice.dom.is(ice.dom.getBlockParent(i,this.element),this.blockEl)){e!==ice.dom.getBlockParent(a.endContainer,this.element)&&a.setEnd(e,0);o=ice.dom.getElementsBetween(a.startContainer,a.endContainer);for(l=0;l<o.length;l++)ice.dom.remove(o[l]);o=a.endContainer;ice.dom.remove(ice.dom.find(a.startContainer,"br"));ice.dom.remove(ice.dom.find(o,"br"));return ice.dom.mergeBlockWithSibling(a,ice.dom.getBlockParent(a.endContainer,this.element)||b)}if(f){ice.dom.remove(e);
a.collapse(true);return true}a.setStart(e,0);a.collapse(true);return true}b=a.endContainer.splitText(a.endOffset);b.splitText(1);return this._addNodeTracking(b,a,false)},_deleteLeft:function(a){var b=ice.dom.isBlockElement(a.startContainer)&&a.startContainer||ice.dom.getBlockParent(a.startContainer,this.element)||null,c=b?ice.dom.hasNoTextOrStubContent(b):false,e=b&&ice.dom.getPrevContentNode(b,this.element),f=e?ice.dom.hasNoTextOrStubContent(e):false,k=a.startContainer,o=a.startOffset,l=a.commonAncestorContainer,
i;if(c)return false;if(o===0||l.nodeType!==ice.dom.TEXT_NODE){if(ice.dom.isBlockElement(l)&&!ice.dom.canContainTextElement(l))if(o===0){if(i=l.firstElementChild){a.setStart(i,0);a.collapse();return this._deleteLeft(a)}}else if(i=l.lastElementChild)if(c=a.getLastSelectableChild(i)){a.setStart(c,c.data.length);a.collapse();return this._deleteLeft(a)}i=o===0?ice.dom.getPrevContentNode(k,this.element):l.childNodes[o-1];if(!i)return false;if(ice.dom.is(i,"."+this._getIceNodeClass("insertType")+", ."+this._getIceNodeClass("deleteType"))&&
i.childNodes.length>0&&i.lastChild)i=i.lastChild;if(i.nodeType===ice.dom.TEXT_NODE)i=i.parentNode;if(!i.isContentEditable){b=this._addNodeTracking(i,false,true);e=document.createTextNode("");i.parentNode.insertBefore(e,i);a.selectNode(e);a.collapse(true);return b}if(this._handleVoidEl(i,a))return true;if(ice.dom.isStubElement(i)&&ice.dom.isChildOf(i,b)||!i.isContentEditable)return this._addNodeTracking(i,a,true);if(ice.dom.isStubElement(i)){ice.dom.remove(i);a.collapse(true);return false}if(i!==b&&
!ice.dom.isChildOf(i,b)){if(!ice.dom.canContainTextElement(i))i=i.lastElementChild;if(i.lastChild&&i.lastChild.nodeType!==ice.dom.TEXT_NODE&&ice.dom.isStubElement(i.lastChild)){a.setStartAfter(i.lastChild);a.collapse(true);return true}if((c=a.getLastSelectableChild(i))&&!ice.dom.isOnBlockBoundary(a.startContainer,c,this.element)){a.selectNodeContents(c);a.collapse();return true}}}if(o===1&&!ice.dom.isBlockElement(l)&&a.startContainer.childNodes.length>1&&a.startContainer.childNodes[0].nodeType===
ice.dom.TEXT_NODE&&a.startContainer.childNodes[0].data.length===0){a.setStart(a.startContainer,0);return this._deleteLeft(a)}a.moveStart(ice.dom.CHARACTER_UNIT,-1);a.moveStart(ice.dom.CHARACTER_UNIT,1);if(this._getNoTrackElement(a.startContainer.parentElement)){a.deleteContents();return false}if(ice.dom.isOnBlockBoundary(a.startContainer,a.endContainer,this.element)){if(f){ice.dom.remove(e);a.collapse();return true}if(this.mergeBlocks&&ice.dom.is(ice.dom.getBlockParent(i,this.element),this.blockEl)){e!==
ice.dom.getBlockParent(a.startContainer,this.element)&&a.setStart(e,e.childNodes.length);e=ice.dom.getElementsBetween(a.startContainer,a.endContainer);for(f=0;f<e.length;f++)ice.dom.remove(e[f]);e=a.endContainer;ice.dom.remove(ice.dom.find(a.startContainer,"br"));ice.dom.remove(ice.dom.find(e,"br"));return ice.dom.mergeBlockWithSibling(a,ice.dom.getBlockParent(a.endContainer,this.element)||b)}if(e&&e.lastChild&&ice.dom.isStubElement(e.lastChild)){a.setStartAfter(e.lastChild);a.collapse(true);return true}if(c=
a.getLastSelectableChild(e)){a.setStart(c,c.data.length);a.collapse(true)}else if(e){a.setStart(e,e.childNodes.length);a.collapse(true)}return true}b=a.startContainer.splitText(a.startOffset-1);b.splitText(1);return this._addNodeTracking(b,a,true)},_addNodeTracking:function(a,b,c){var e=this.getIceNode(a,"insertType");if(e&&this._currentUserIceNode(e)){b&&c&&b.selectNode(a);a.parentNode.removeChild(a);a=ice.dom.cloneNode(e);ice.dom.remove(ice.dom.find(a,".iceBookmark"));if(e!==null&&ice.dom.hasNoTextOrStubContent(a[0])){a=
this.env.document.createTextNode("");ice.dom.insertBefore(e,a);if(b){b.setStart(a,0);b.collapse(true)}ice.dom.replaceWith(e,ice.dom.contents(e))}return true}if(b&&this.getIceNode(a,"deleteType")){a.normalize();var f=false;if(c){for(a=ice.dom.getPrevContentNode(a,this.element);!f;)(e=this.getIceNode(a,"deleteType"))?a=ice.dom.getPrevContentNode(a,this.element):f=true;if(a){(c=b.getLastSelectableChild(a))&&(a=c);b.setStart(a,ice.dom.getNodeCharacterLength(a));b.collapse(true)}}else{for(a=ice.dom.getNextContentNode(a,
this.element);!f;)(e=this.getIceNode(a,"deleteType"))?a=ice.dom.getNextContentNode(a,this.element):f=true;if(a){b.selectNodeContents(a);b.collapse(true)}}return true}a.previousSibling&&(a.previousSibling.nodeType===ice.dom.TEXT_NODE&&a.previousSibling.length===0)&&a.parentNode.removeChild(a.previousSibling);a.nextSibling&&(a.nextSibling.nodeType===ice.dom.TEXT_NODE&&a.nextSibling.length===0)&&a.parentNode.removeChild(a.nextSibling);e=this.getIceNode(a.previousSibling,"deleteType");f=this.getIceNode(a.nextSibling,
"deleteType");if(e&&this._currentUserIceNode(e)){e.appendChild(a);if(f&&this._currentUserIceNode(f)){var k=ice.dom.extractContent(f);ice.dom.append(e,k);f.parentNode.removeChild(f)}}else if(f&&this._currentUserIceNode(f)){e=f;e.insertBefore(a,e.firstChild)}else{e=this.createIceNode("deleteType");a.parentNode.insertBefore(e,a);e.appendChild(a)}if(b){ice.dom.isStubElement(a)?b.selectNode(a):b.selectNodeContents(a);c?b.collapse(true):b.collapse();a.normalize()}return true},_handleAncillaryKey:function(a){var b=
true;switch(a.keyCode){case ice.dom.DOM_VK_DELETE:b=this.deleteContents();this.pluginsManager.fireKeyPressed(a);break;case 46:b=this.deleteContents(true);this.pluginsManager.fireKeyPressed(a);break;case ice.dom.DOM_VK_DOWN:case ice.dom.DOM_VK_UP:case ice.dom.DOM_VK_LEFT:case ice.dom.DOM_VK_RIGHT:this.pluginsManager.fireCaretPositioned();b=false;break;default:b=false}if(b===true){ice.dom.preventDefault(a);return false}return true},keyDown:function(a){if(!this.pluginsManager.fireKeyDown(a)){ice.dom.preventDefault(a);
return false}var b=false;if(this._handleSpecialKey(a)===false){if(ice.dom.isBrowser("msie")!==true)this._preventKeyPress=true;return false}if((a.ctrlKey===true||a.metaKey===true)&&(ice.dom.isBrowser("msie")===true||ice.dom.isBrowser("chrome")===true)&&!this.pluginsManager.fireKeyPressed(a))return false;switch(a.keyCode){case 27:break;default:/Firefox/.test(navigator.userAgent)!==true&&(b=!this._handleAncillaryKey(a))}if(b){ice.dom.preventDefault(a);return false}return true},keyPress:function(a){if(this._preventKeyPress===
true)this._preventKeyPress=false;else{var b=null;a.which==null?b=String.fromCharCode(a.keyCode):a.which>0&&(b=String.fromCharCode(a.which));if(!this.pluginsManager.fireKeyPress(a))return false;if(a.ctrlKey||a.metaKey)return true;var c=this.getCurrentRange(),e=ice.dom.parents(c.startContainer,"br")[0]||null;if(e){c.moveToNextEl(e);e.parentNode.removeChild(e)}if(b!==null&&a.ctrlKey!==true&&a.metaKey!==true)switch(a.keyCode){case ice.dom.DOM_VK_DELETE:break;case ice.dom.DOM_VK_ENTER:return this._handleEnter();
default:this._moveRangeToValidTrackingPos(c,c.startContainer);return this.insert(b)}return this._handleAncillaryKey(a)}},_handleEnter:function(){this.getCurrentRange().collapsed||this.deleteContents();return true},_handleSpecialKey:function(a){var b=a.which;if(b===null)b=a.keyCode;var c=false;switch(b){case 65:if(a.ctrlKey===true||a.metaKey===true){c=true;b=this.getCurrentRange();if(ice.dom.isBrowser("msie")===true){var e=this.env.document.createTextNode(""),f=this.env.document.createTextNode("");
this.element.firstChild?ice.dom.insertBefore(this.element.firstChild,e):this.element.appendChild(e);this.element.appendChild(f);b.setStart(e,0);b.setEnd(f,0)}else{b.setStart(b.getFirstSelectableChild(this.element),0);e=b.getLastSelectableChild(this.element);b.setEnd(e,e.length)}this.selection.addRange(b)}}if(c===true){ice.dom.preventDefault(a);return false}return true},mouseUp:function(a){if(!this.pluginsManager.fireClicked(a))return false;this.pluginsManager.fireSelectionChanged(this.getCurrentRange())},
mouseDown:function(a){if(!this.pluginsManager.fireMouseDown(a))return false;this.pluginsManager.fireCaretUpdated()}};this.ice=this.ice||{};this.ice.InlineChangeEditor=b}).call(this);
(function(){var c={DOM_VK_DELETE:8,DOM_VK_LEFT:37,DOM_VK_UP:38,DOM_VK_RIGHT:39,DOM_VK_DOWN:40,DOM_VK_ENTER:13,ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12,CHARACTER_UNIT:"character",WORD_UNIT:"word",BREAK_ELEMENT:"br",CONTENT_STUB_ELEMENTS:["img","hr","iframe","param","link","meta","input","frame","col","base","area"],
BLOCK_ELEMENTS:["p","div","pre","ul","ol","li","table","tbody","td","th","fieldset","form","blockquote","dl","dt","dd","dir","center","address","h1","h2","h3","h4","h5","h6"],TEXT_CONTAINER_ELEMENTS:["p","div","pre","li","td","th","blockquote","dt","dd","center","address","h1","h2","h3","h4","h5","h6"]};c.STUB_ELEMENTS=c.CONTENT_STUB_ELEMENTS.slice();c.STUB_ELEMENTS.push(c.BREAK_ELEMENT);c.getKeyChar=function(b){return String.fromCharCode(b.which)};c.getClass=function(b,a,d){if(!a)a=document.body;
b="."+b.split(" ").join(".");d&&(b=d+b);return jQuery.makeArray(jQuery(a).find(b))};c.getId=function(b,a){a||(a=document);return element=a.getElementById(b)};c.getTag=function(b,a){a||(a=document);return jQuery.makeArray(jQuery(a).find(b))};c.getElementWidth=function(b){return b.offsetWidth};c.getElementHeight=function(b){return b.offsetHeight};c.getElementDimensions=function(b){return{width:c.getElementWidth(b),height:c.getElementHeight(b)}};c.trim=function(b){return jQuery.trim(b)};c.empty=function(b){if(b)return jQuery(b).empty()};
c.remove=function(b){if(b)return jQuery(b).remove()};c.prepend=function(b,a){jQuery(b).prepend(a)};c.append=function(b,a){jQuery(b).append(a)};c.insertBefore=function(b,a){jQuery(b).before(a)};c.insertAfter=function(b,a){jQuery(b).after(a)};c.getHtml=function(b){return jQuery(b).html()};c.setHtml=function(b,a){b&&jQuery(b).html(a)};c.removeWhitespace=function(b){jQuery(b).contents().filter(function(){if(this.nodeType!=ice.dom.TEXT_NODE&&this.nodeName=="UL"||this.nodeName=="OL"){c.removeWhitespace(this);
return false}return this.nodeType!=ice.dom.TEXT_NODE?false:!/\S/.test(this.nodeValue)}).remove()};c.contents=function(b){return jQuery.makeArray(jQuery(b).contents())};c.extractContent=function(b){for(var a=document.createDocumentFragment(),d;d=b.firstChild;)a.appendChild(d);return a};c.getNode=function(b,a){return c.is(b,a)?b:c.parents(b,a)[0]||null};c.getParents=function(b,a,d){for(var b=jQuery(b).parents(a),a=b.length,c=[],e=0;e<a;e++){if(b[e]===d)break;c.push(b[e])}return c};c.hasBlockChildren=
function(b){for(var a=b.childNodes.length,d=0;d<a;d++)if(b.childNodes[d].nodeType===c.ELEMENT_NODE&&c.isBlockElement(b.childNodes[d])===true)return true;return false};c.removeTag=function(b,a){jQuery(b).find(a).replaceWith(function(){return jQuery(this).contents()});return b};c.stripEnclosingTags=function(b,a){var d=jQuery(b);d.find("*").not(a).replaceWith(function(){var a=jQuery(),b;try{b=jQuery(this);a=b.contents()}catch(d){}a.length===0&&b.remove();return a});return d[0]};c.getSiblings=function(b,
a,d,c){if(d===true)return a==="prev"?jQuery(b).prevAll():jQuery(b).nextAll();d=[];if(a==="prev")for(;b.previousSibling;){b=b.previousSibling;if(b===c)break;d.push(b)}else for(;b.nextSibling;){b=b.nextSibling;if(b===c)break;d.push(b)}return d};c.getNodeTextContent=function(b){return jQuery(b).text()};c.getNodeStubContent=function(b){return jQuery(b).find(c.CONTENT_STUB_ELEMENTS.join(", "))};c.hasNoTextOrStubContent=function(b){return c.getNodeTextContent(b).length>0||jQuery(b).find(c.CONTENT_STUB_ELEMENTS.join(", ")).length>
0?false:true};c.getNodeCharacterLength=function(b){return c.getNodeTextContent(b).length+jQuery(b).find(c.STUB_ELEMENTS.join(", ")).length};c.setNodeTextContent=function(b,a){return jQuery(b).text(a)};c.getTagName=function(b){return b.tagName&&b.tagName.toLowerCase()||null};c.getIframeDocument=function(b){var a=null;if(b.contentDocument)a=b.contentDocument;else if(b.contentWindow)a=b.contentWindow.document;else if(b.document)a=b.document;return a};c.isBlockElement=function(b){return c.BLOCK_ELEMENTS.lastIndexOf(b.nodeName.toLowerCase())!=
-1};c.isStubElement=function(b){return c.STUB_ELEMENTS.lastIndexOf(b.nodeName.toLowerCase())!=-1};c.isChildOf=function(b,a){try{for(;b&&b.parentNode;){if(b.parentNode===a)return true;b=b.parentNode}}catch(d){}return false};c.isChildOfTagName=function(b,a){var d=null;try{for(;b&&b.parentNode;){if(b.parentNode&&b.parentNode.tagName&&b.parentNode.tagName.toLowerCase()===a)d=b.parentNode;b=b.parentNode}}catch(c){}return d};c.isChildOfTagNames=function(b,a){var d=null;try{for(;b&&b.parentNode;){if(b.parentNode&&
b.parentNode.tagName){tagName=b.parentNode.tagName.toLowerCase();for(var c=0;c<a.length;c++)if(tagName===a[c]){d=b.parentNode;break}}b=b.parentNode}}catch(e){}return d};c.isChildOfClassName=function(b,a){var d=null;try{for(;b&&b.parentNode;){if(jQuery(b.parentNode).hasClass(a))d=b.parentNode;b=b.parentNode}}catch(c){}return d};c.cloneNode=function(b,a){a===void 0&&(a=true);return jQuery(b).clone(a)};c.bind=function(b,a,d){return jQuery(b).bind(a,d)};c.unbind=function(b,a,d){return jQuery(b).unbind(a,
d)};c.attr=function(b,a,d){return d?jQuery(b).attr(a,d):jQuery(b).attr(a)};c.replaceWith=function(b,a){return jQuery(b).replaceWith(a)};c.removeAttr=function(b,a){jQuery(b).removeAttr(a)};c.getElementsBetween=function(b,a){var d=[];if(b===a)return d;if(c.isChildOf(a,b)===true){for(var g=b.childNodes.length,e=0;e<g;e++)if(b.childNodes[e]===a)break;else{if(c.isChildOf(a,b.childNodes[e])===true)return c.arrayMerge(d,c.getElementsBetween(b.childNodes[e],a));d.push(b.childNodes[e])}return d}for(g=b.nextSibling;g;){if(c.isChildOf(a,
g)===true)return d=c.arrayMerge(d,c.getElementsBetween(g,a));if(g===a)return d;d.push(g);g=g.nextSibling}for(var g=c.getParents(b),e=c.getParents(a),g=c.arrayDiff(g,e,true),e=g.length,f=0;f<e-1;f++)d=c.arrayMerge(d,c.getSiblings(g[f],"next"));return d=c.arrayMerge(d,c.getElementsBetween(g[g.length-1],a))};c.getCommonAncestor=function(b,a){for(var d=b;d;){if(c.isChildOf(a,d)===true)return d;d=d.parentNode}return null};c.getNextNode=function(b,a){if(b)for(;b.parentNode;){if(b===a)break;if(b.nextSibling){if(b.nextSibling.nodeType===
c.TEXT_NODE&&b.nextSibling.length===0){b=b.nextSibling;continue}return c.getFirstChild(b.nextSibling)}b=b.parentNode}return null};c.getNextContentNode=function(b,a){if(b)for(;b.parentNode;){if(b===a)break;if(b.nextSibling&&c.canContainTextElement(c.getBlockParent(b))){if(b.nextSibling.nodeType===c.TEXT_NODE&&b.nextSibling.length===0){b=b.nextSibling;continue}return b.nextSibling}if(b.nextElementSibling)return b.nextElementSibling;b=b.parentNode}return null};c.getPrevNode=function(b,a){if(b)for(;b.parentNode;){if(b===
a)break;if(b.previousSibling){if(b.previousSibling.nodeType===c.TEXT_NODE&&b.previousSibling.length===0){b=b.previousSibling;continue}return c.getLastChild(b.previousSibling)}b=b.parentNode}return null};c.getPrevContentNode=function(b,a){if(b)for(;b.parentNode;){if(b===a)break;if(b.previousSibling&&c.canContainTextElement(c.getBlockParent(b))){if(b.previousSibling.nodeType===c.TEXT_NODE&&b.previousSibling.length===0){b=b.previousSibling;continue}return b.previousSibling}if(b.previousElementSibling)return b.previousElementSibling;
b=b.parentNode}return null};c.canContainTextElement=function(b){return b&&b.nodeName?c.TEXT_CONTAINER_ELEMENTS.lastIndexOf(b.nodeName.toLowerCase())!=-1:false};c.getFirstChild=function(b){return b.firstChild?b.firstChild.nodeType===c.ELEMENT_NODE?c.getFirstChild(b.firstChild):b.firstChild:b};c.getLastChild=function(b){return b.lastChild?b.lastChild.nodeType===c.ELEMENT_NODE?c.getLastChild(b.lastChild):b.lastChild:b};c.removeEmptyNodes=function(b,a){for(var d=jQuery(b).find(":empty"),g=d.length;g>
0;){g--;c.isStubElement(d[g])===false&&(!a||a.call(this,d[g])!==false)&&c.remove(d[g])}};c.create=function(b){return jQuery(b)[0]};c.find=function(b,a){return jQuery(b).find(a)};c.children=function(b,a){return jQuery(b).children(a)};c.parent=function(b,a){return jQuery(b).parent(a)[0]};c.parents=function(b,a){return jQuery(b).parents(a)};c.is=function(b,a){return jQuery(b).is(a)};c.extend=function(b,a,d,c){return jQuery.extend.apply(this,arguments)};c.walk=function(b,a,d){if(b){d||(d=0);a.call(this,
b,d)!==false&&(b.childNodes&&b.childNodes.length>0?c.walk(b.firstChild,a,d+1):b.nextSibling?c.walk(b.nextSibling,a,d):b.parentNode&&b.parentNode.nextSibling&&c.walk(b.parentNode.nextSibling,a,d-1))}};c.revWalk=function(b,a){b&&a.call(this,b)!==false&&(b.childNodes&&b.childNodes.length>0?c.walk(b.lastChild,a):b.previousSibling?c.walk(b.previousSibling,a):b.parentNode&&b.parentNode.previousSibling&&c.walk(b.parentNode.previousSibling,a))};c.setStyle=function(b,a,d){b&&jQuery(b).css(a,d)};c.getStyle=
function(b,a){return jQuery(b).css(a)};c.hasClass=function(b,a){return jQuery(b).hasClass(a)};c.addClass=function(b,a){jQuery(b).addClass(a)};c.removeClass=function(b,a){jQuery(b).removeClass(a)};c.preventDefault=function(b){b.preventDefault();c.stopPropagation(b)};c.stopPropagation=function(b){b.stopPropagation()};c.noInclusionInherits=function(b,a){if(a instanceof String||typeof a==="string")a=window[a];if(b instanceof String||typeof b==="string")b=window[b];var d=function(){};if(c.isset(a)===true)for(value in a.prototype)b.prototype[value]?
d.prototype[value]=a.prototype[value]:b.prototype[value]=a.prototype[value];if(b.prototype){d.prototype.constructor=a;b.prototype["super"]=new d}};c.each=function(b,a){jQuery.each(b,function(b,c){a.call(this,b,c)})};c.foreach=function(b,a){if(b instanceof Array||b instanceof NodeList||typeof b.length!="undefined"&&typeof b.item!="undefined")for(var d=b.length,c=0;c<d;c++){var e=a.call(this,c,b[c]);if(e===false)break}else for(d in b)if(b.hasOwnProperty(d)===true){e=a.call(this,d);if(e===false)break}};
c.isBlank=function(b){return!b||/^\s*$/.test(b)?true:false};c.isFn=function(b){return typeof b==="function"?true:false};c.isObj=function(b){return b!==null&&typeof b==="object"?true:false};c.isset=function(b){return typeof b!=="undefined"&&b!==null?true:false};c.isArray=function(b){return jQuery.isArray(b)};c.isNumeric=function(b){return b.match(/^\d+$/)!==null?true:false};c.getUniqueId=function(){var b=(new Date).getTime(),a=Math.ceil(Math.random()*1E6);return(b+""+a).substr(5,18).replace(/,/,"")};
c.inArray=function(b,a){for(var d=a.length,c=0;c<d;c++)if(b===a[c])return true;return false};c.arrayDiff=function(b,a,d){for(var g=b.length,e=[],f=0;f<g;f++)c.inArray(b[f],a)===false&&e.push(b[f]);if(d!==true){g=a.length;for(f=0;f<g;f++)c.inArray(a[f],b)===false&&e.push(a[f])}return e};c.arrayMerge=function(b,a){for(var d=a.length,c=0;c<d;c++)b.push(a[c]);return b};c.stripTags=function(b,a){if(typeof a==="string"){var d=jQuery("<div>"+b+"</div>");d.find("*").not(a).remove();return d.html()}for(var g=
RegExp(/<\/?(\w+)((\s+\w+(\s*=\s*(?:".*?"|'.*?'|[^'">\s]+))?)+\s*|\s*)\/?>/gim),e=b;(d=g.exec(b))!=null;)if(c.isset(a)===false||c.inArray(d[1],a)!==true)e=e.replace(d[0],"");return e};c.browser=function(){var b={},a=jQuery.browser||{webkit:true};b.version=a.version;if(a.mozilla===true)b.type="mozilla";else if(a.msie===true)b.type="msie";else if(a.opera===true)b.type="opera";else if(a.webkit===true)b.type="webkit";return b};c.getBrowserType=function(){if(this._browserType===null){for(var b=["msie",
"firefox","chrome","safari"],a=b.length,d=0;d<a;d++)if(RegExp(b[d],"i").test(navigator.userAgent)===true)return this._browserType=b[d];this._browserType="other"}return this._browserType};c.getWebkitType=function(){if(c.browser().type!=="webkit"){console.log("Not a webkit!");return false}return Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0?"safari":"chrome"};c.isBrowser=function(b){return c.browser().type===b};c.getBlockParent=function(b,a){if(c.isBlockElement(b)===true)return b;
if(b)for(;b.parentNode;){b=b.parentNode;if(b===a)break;if(c.isBlockElement(b)===true)return b}return null};c.findNodeParent=function(b,a,d){if(b)for(;b.parentNode;){if(b===d)break;if(c.is(b,a)===true)return b;b=b.parentNode}return null};c.onBlockBoundary=function(b,a,d){if(!b||!a)return false;b=c.isChildOfTagNames(b,d)||c.is(b,d.join(", "))&&b||null;a=c.isChildOfTagNames(a,d)||c.is(a,d.join(", "))&&a||null;return b!==a};c.isOnBlockBoundary=function(b,a,d){if(!b||!a)return false;b=c.getBlockParent(b,
d)||c.isBlockElement(b,d)&&b||null;a=c.getBlockParent(a,d)||c.isBlockElement(a,d)&&a||null;return b!==a};c.mergeContainers=function(b,a){if(!b||!a)return false;if(b.nodeType===c.TEXT_NODE||c.isStubElement(b))a.appendChild(b);else if(b.nodeType===c.ELEMENT_NODE){for(;b.firstChild;)a.appendChild(b.firstChild);c.remove(b)}return true};c.mergeBlockWithSibling=function(b,a,d){var g=d?jQuery(a).next().get(0):jQuery(a).prev().get(0);d?c.mergeContainers(g,a):c.mergeContainers(a,g);b.collapse(true);return true};
c.date=function(b,a,d){if(a===null&&d){a=c.tsIso8601ToTimestamp(d);if(!a)return}for(var a=new Date(a),b=b.split(""),d=b.length,g="",e=0;e<d;e++){var f="",k=b[e];switch(k){case "D":case "l":f=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][a.getDay()];k==="D"&&(f=f.substring(0,3));break;case "F":case "m":f=a.getMonth()+1;f<10&&(f="0"+f);break;case "M":months=["January","February","March","April","May","June","July","August","September","October","November","December"];f=months[a.getMonth()];
k==="M"&&(f=f.substring(0,3));break;case "d":f=a.getDate();break;case "S":f=c.getOrdinalSuffix(a.getDate());break;case "Y":f=a.getFullYear();break;case "y":f=a.getFullYear();f=f.toString().substring(2);break;case "H":f=a.getHours();break;case "h":f=a.getHours();f===0?f=12:f>12&&(f=f-12);break;case "i":f=c.addNumberPadding(a.getMinutes());break;case "a":f="am";a.getHours()>=12&&(f="pm");break;default:f=k}g=g+f}return g};c.getOrdinalSuffix=function(b){var a="",a=b%100;if(a>=4&&a<=20)a="th";else switch(b%
10){case 1:a="st";break;case 2:a="nd";break;case 3:a="rd";break;default:a="th"}return a};c.addNumberPadding=function(b){b<10&&(b="0"+b);return b};c.tsIso8601ToTimestamp=function(b){if(b=b.match(RegExp(/(\d\d\d\d)(?:-?(\d\d)(?:-?(\d\d)(?:[T ](\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(?:Z|(?:([-+])(\d\d)(?::?(\d\d))?)?)?)?)?)?/))){var a=new Date;a.setDate(b[3]);a.setFullYear(b[1]);a.setMonth(b[2]-1);a.setHours(b[4]);a.setMinutes(b[5]);a.setSeconds(b[6]);var d=b[9]*60;b[8]==="+"&&(d=d*-1);d=d-a.getTimezoneOffset();
return a.getTime()+d*6E4}return null};this.dom=c}).call(this.ice);
(function(){var c=function(b){this._ice=b};c.prototype={start:function(){},clicked:function(){return true},mouseDown:function(){return true},keyDown:function(){return true},keyPress:function(){return true},selectionChanged:function(){},setEnabled:function(){},setDisabled:function(){},caretUpdated:function(){},nodeInserted:function(){},nodeCreated:function(){},caretPositioned:function(){},remove:function(){this._ice.removeKeyPressListener(this)},setSettings:function(){}};this.IcePlugin=c}).call(this.ice);
(function(){var c=function(b){this.plugins={};this.pluginConstructors={};this.keyPressListeners={};this.activePlugin=null;this.pluginSets={};this.activePluginSet=null;this._ice=b};c.prototype={getPluginNames:function(){var b=[],a;for(a in this.plugins)b.push(a);return b},addPluginObject:function(b,a){this.plugins[b]=a},addPlugin:function(b,a){if(typeof a!=="function")throw Error("IcePluginException: plugin must be a constructor function");ice.dom.isset(this.pluginConstructors[b])===false&&(this.pluginConstructors[b]=
a)},loadPlugins:function(b,a){if(b.length===0)a.call(this);else{var d=b.shift();if(typeof d==="object")d=d.name;if(ice.dom.isset(ice._plugin[d])===true){this.addPlugin(d,ice._plugin[d]);this.loadPlugins(b,a)}else throw Error("plugin was not included in the page: "+d);}},_enableSet:function(b){this.activePluginSet=b;for(var a=this.pluginSets[b].length,d=0;d<a;d++){var c=this.pluginSets[b][d],e="",e=typeof c==="object"?c.name:c,f=this.pluginConstructors[e];if(f){f=new f(this._ice);this.plugins[e]=f;
ice.dom.isset(c.settings)===true&&f.setSettings(c.settings);f.start()}}},setActivePlugin:function(b){this.activePlugin=b},getActivePlugin:function(){return this.activePlugin},_getPluginName:function(b){b=b.toString();return b.substr(9,b.indexOf("(")-9)},removePlugin:function(b){this.plugins[b]&&this.plugins[b].remove()},getPlugin:function(b){return this.plugins[b]},usePlugins:function(b,a,d){var c=this;this.pluginSets[b]=ice.dom.isset(a)===true?a:[];this.loadPlugins(this.pluginSets[b].concat([]),
function(){c._enableSet(b);d&&d.call(this)})},disablePlugin:function(b){this.plugins[b].disable()},isPluginElement:function(b){for(var a in this.plugins)if(this.plugins[a].isPluginElement&&this.plugins[a].isPluginElement(b)===true)return true;return false},fireKeyPressed:function(b){if(this._fireKeyPressFns(b,"all_keys")===false)return false;var a=[];(b.ctrlKey===true||b.metaKey===true)&&a.push("ctrl");b.shiftKey===true&&a.push("shift");b.altKey===true&&a.push("alt");switch(b.keyCode){case 13:a.push("enter");
break;case ice.dom.DOM_VK_LEFT:a.push("left");break;case ice.dom.DOM_VK_RIGHT:a.push("right");break;case ice.dom.DOM_VK_UP:a.push("up");break;case ice.dom.DOM_VK_DOWN:a.push("down");break;case 9:a.push("tab");break;case ice.dom.DOM_VK_DELETE:a.push("delete");break;default:var d;if(b.keyCode)d=b.keyCode;else if(b.which)d=b.which;d&&a.push(String.fromCharCode(d).toLowerCase())}a=a.sort().join("+");return this._fireKeyPressFns(b,a)},_fireKeyPressFns:function(b,a){if(this.keyPressListeners[a])for(var d=
this.keyPressListeners[a].length,c=0;c<d;c++){var e=this.keyPressListeners[a][c],f=e.fn,k=e.plugin,e=e.data;if(f)if(ice.dom.isFn(f)===true){if(f.call(k,b,e)===true){ice.dom.preventDefault(b);return false}}else if(k[f]&&k[f].call(k,b,e)===true){ice.dom.preventDefault(b);return false}}return true},fireSelectionChanged:function(b){for(var a in this.plugins)this.plugins[a].selectionChanged(b)},fireNodeInserted:function(b,a){for(var d in this.plugins)if(this.plugins[d].nodeInserted(b,a)===false)return false},
fireNodeCreated:function(b,a){for(var d in this.plugins)if(this.plugins[d].nodeCreated(b,a)===false)return false},fireCaretPositioned:function(){for(var b in this.plugins)this.plugins[b].caretPositioned()},fireClicked:function(b){var a=true,d;for(d in this.plugins)this.plugins[d].clicked(b)===false&&(a=false);return a},fireMouseDown:function(b){var a=true,d;for(d in this.plugins)this.plugins[d].mouseDown(b)===false&&(a=false);return a},fireKeyDown:function(b){var a=true,d;for(d in this.plugins)this.plugins[d].keyDown(b)===
false&&(a=false);return a},fireKeyPress:function(b){var a=true,d;for(d in this.plugins)this.plugins[d].keyPress(b)===false&&(a=false);return a},fireEnabled:function(b){for(var a in this.plugins)this.plugins[a].setEnabled(b)},fireDisabled:function(b){for(var a in this.plugins)this.plugins[a].setDisabled(b)},fireCaretUpdated:function(){for(var b in this.plugins)this.plugins[b].caretUpdated&&this.plugins[b].caretUpdated()}};this._plugin={};this.IcePluginManager=c}).call(this.ice);
(function(){var c;c=function(b,a,d){this.env=b;this.element=b.element;this.selection=this.env.selection;d||this.removeBookmarks(this.element);var b=a||this.selection.getRangeAt(0),a=b.cloneRange(),c=a.startContainer,e=a.startOffset,f;a.collapse(false);d=this.env.document.createElement("span");d.style.display="none";ice.dom.setHtml(d,"&nbsp;");ice.dom.addClass(d,"iceBookmark iceBookmark_end");d.setAttribute("iceBookmark","end");a.insertNode(d);ice.dom.isChildOf(d,this.element)||this.element.appendChild(d);
a.setStart(c,e);a.collapse(true);c=this.env.document.createElement("span");c.style.display="none";ice.dom.addClass(c,"iceBookmark iceBookmark_start");ice.dom.setHtml(c,"&nbsp;");c.setAttribute("iceBookmark","start");try{a.insertNode(c);if(c.previousSibling===d){f=c;c=d;d=f}}catch(k){ice.dom.insertBefore(d,c)}ice.dom.isChildOf(c,this.element)===false&&(this.element.firstChild?ice.dom.insertBefore(this.element.firstChild,c):this.element.appendChild(c));if(!d.previousSibling){f=this.env.document.createTextNode("");
ice.dom.insertBefore(d,f)}if(!c.nextSibling){f=this.env.document.createTextNode("");ice.dom.insertAfter(c,f)}b.setStart(c.nextSibling,0);b.setEnd(d.previousSibling,d.previousSibling.length||0);this.start=c;this.end=d};c.prototype={selectBookmark:function(){var b=this.selection.getRangeAt(0),a=null,d=null,c=0,e=null;if(this.start.nextSibling===this.end||ice.dom.getElementsBetween(this.start,this.end).length===0)if(this.end.nextSibling)a=ice.dom.getFirstChild(this.end.nextSibling);else if(this.start.previousSibling){a=
ice.dom.getFirstChild(this.start.previousSibling);if(a.nodeType===ice.dom.TEXT_NODE)c=a.length}else{this.end.parentNode.appendChild(this.env.document.createTextNode(""));a=ice.dom.getFirstChild(this.end.nextSibling)}else{if(this.start.nextSibling)a=ice.dom.getFirstChild(this.start.nextSibling);else{if(!this.start.previousSibling){a=this.env.document.createTextNode("");ice.dom.insertBefore(this.start,a)}a=ice.dom.getLastChild(this.start.previousSibling);c=a.length}if(this.end.previousSibling)d=ice.dom.getLastChild(this.end.previousSibling);
else{d=ice.dom.getFirstChild(this.end.nextSibling||this.end);e=0}}ice.dom.remove([this.start,this.end]);if(d===null){b.setEnd(a,c);b.collapse(false)}else{b.setStart(a,c);e===null&&(e=d.length||0);b.setEnd(d,e)}try{this.selection.addRange(b)}catch(f){}},getBookmark:function(b,a){return ice.dom.getClass("iceBookmark_"+a,b)[0]},removeBookmarks:function(b){ice.dom.remove(ice.dom.getClass("iceBookmark",b,"span"))}};this.Bookmark=c}).call(this.ice);
(function(){var c;c=function(b){this._selection=null;this.env=b;this._initializeRangeLibrary();this._getSelection()};c.prototype={_getSelection:function(){this._selection?this._selection.refresh():this._selection=this.env.frame?rangy.getIframeSelection(this.env.frame):rangy.getSelection();return this._selection},createRange:function(){return rangy.createRange(this.env.document)},getRangeAt:function(b){this._selection.refresh();try{return this._selection.getRangeAt(b)}catch(a){this._selection=null;
return this._getSelection().getRangeAt(0)}},addRange:function(b){this._selection||(this._selection=this._getSelection());this._selection.setSingleRange(b);this._selection.ranges=[b]},_initializeRangeLibrary:function(){var b=this;rangy.init();rangy.config.checkSelectionRanges=false;var a=function(a,b,c,f){if(c===0)throw Error("InvalidArgumentException: units cannot be 0");switch(b){case ice.dom.CHARACTER_UNIT:c>0?a.moveCharRight(f,c):a.moveCharLeft(f,c*-1)}};rangy.rangePrototype.moveStart=function(b,
c){a(this,b,c,true)};rangy.rangePrototype.moveEnd=function(b,c){a(this,b,c,false)};rangy.rangePrototype.setRange=function(a,b,c){a?this.setStart(b,c):this.setEnd(b,c)};rangy.rangePrototype.moveCharLeft=function(a,b){var c,f;if(a){c=this.startContainer;f=this.startOffset}else{c=this.endContainer;f=this.endOffset}if(c.nodeType===ice.dom.ELEMENT_NODE)if(c.hasChildNodes()){c=c.childNodes[f];for(c=this.getPreviousTextNode(c);c&&c.nodeType==ice.dom.TEXT_NODE&&c.nodeValue==="";)c=this.getPreviousTextNode(c);
f=c.data.length-b}else f=b*-1;else f=f-b;if(f<0)for(;f<0;){c=this.getPreviousTextNode(c,[]);if(!c)return;c.nodeType!==ice.dom.ELEMENT_NODE&&(f=f+c.data.length)}this.setRange(a,c,f)};rangy.rangePrototype.moveCharRight=function(a,b){var c,f;if(a){c=this.startContainer;f=this.startOffset}else{c=this.endContainer;f=this.endOffset}if(c.nodeType===ice.dom.ELEMENT_NODE){c=c.childNodes[f];c.nodeType!==ice.dom.TEXT_NODE&&(c=this.getNextTextNode(c));f=b}else f=f+b;var k=f-c.data.length;if(k>0){for(f=[];k>0;){c=
this.getNextContainer(c,f);if(!c)return;if(c.nodeType!==ice.dom.ELEMENT_NODE)if(c.data.length>=k)break;else c.data.length>0&&(k=k-c.data.length)}f=k}this.setRange(a,c,f)};rangy.rangePrototype.getNextContainer=function(a,b){if(!a)return null;for(;a.nextSibling;){a=a.nextSibling;if(a.nodeType!==ice.dom.TEXT_NODE){var c=this.getFirstSelectableChild(a);if(c!==null)return c}else if(this.isSelectable(a)===true)return a}for(;a&&!a.nextSibling;)a=a.parentNode;if(!a)return null;a=a.nextSibling;if(this.isSelectable(a)===
true)return a;b&&ice.dom.isBlockElement(a)===true&&b.push(a);c=this.getFirstSelectableChild(a);return c!==null?c:this.getNextContainer(a,b)};rangy.rangePrototype.getPreviousContainer=function(a,b){if(!a)return null;for(;a.previousSibling;){a=a.previousSibling;if(a.nodeType!==ice.dom.TEXT_NODE){if(ice.dom.isStubElement(a)===true)return a;var c=this.getLastSelectableChild(a);if(c!==null)return c}else if(this.isSelectable(a)===true)return a}for(;a&&!a.previousSibling;)a=a.parentNode;if(!a)return null;
a=a.previousSibling;if(this.isSelectable(a)===true)return a;b&&ice.dom.isBlockElement(a)===true&&b.push(a);c=this.getLastSelectableChild(a);return c!==null?c:this.getPreviousContainer(a,b)};rangy.rangePrototype.getNextTextNode=function(a){if(a.nodeType===ice.dom.ELEMENT_NODE&&a.childNodes.length!==0)return this.getFirstSelectableChild(a);a=this.getNextContainer(a);return a.nodeType===ice.dom.TEXT_NODE?a:this.getNextTextNode(a)};rangy.rangePrototype.getPreviousTextNode=function(a,b){a=this.getPreviousContainer(a,
b);return a.nodeType===ice.dom.TEXT_NODE?a:this.getPreviousTextNode(a,b)};rangy.rangePrototype.getFirstSelectableChild=function(a){if(a)if(a.nodeType!==ice.dom.TEXT_NODE)for(a=a.firstChild;a;){if(this.isSelectable(a)===true)return a;if(a.firstChild){var b=this.getFirstSelectableChild(a);if(b!==null)return b}a=a.nextSibling}else return a;return null};rangy.rangePrototype.getLastSelectableChild=function(a){if(a)if(a.nodeType!==ice.dom.TEXT_NODE)for(a=a.lastChild;a;){if(this.isSelectable(a)===true)return a;
if(a.lastChild){var b=this.getLastSelectableChild(a);if(b!==null)return b}a=a.previousSibling}else return a;return null};rangy.rangePrototype.isSelectable=function(a){return a&&a.nodeType===ice.dom.TEXT_NODE&&a.data.length!==0?true:false};rangy.rangePrototype.getHTMLContents=function(a){a||(a=this.cloneContents());var c=b.env.document.createElement("div");c.appendChild(a.cloneNode(true));return c.innerHTML};rangy.rangePrototype.getHTMLContentsObj=function(){return this.cloneContents()}}};this.Selection=
c}).call(this.ice);