(function(){var h=function(a){this.plugins={};this.pluginConstructors={};this.keyPressListeners={};this.activePlugin=null;this.pluginSets={};this.activePluginSet=null;this._ice=a};h.prototype={getPluginNames:function(){var a=[],b;for(b in this.plugins)a.push(b);return a},addPluginObject:function(a,b){this.plugins[a]=b},addPlugin:function(a,b){if("function"!==typeof b)throw Error("IcePluginException: plugin must be a constructor function");!1===ice.dom.isset(this.pluginConstructors[a])&&(this.pluginConstructors[a]=
b)},loadPlugins:function(a,b){if(0===a.length)b.call(this);else{var c=a.shift();"object"===typeof c&&(c=c.name);if(!0===ice.dom.isset(ice._plugin[c]))this.addPlugin(c,ice._plugin[c]),this.loadPlugins(a,b);else throw Error("plugin was not included in the page: "+c);}},_enableSet:function(a){this.activePluginSet=a;for(var b=this.pluginSets[a].length,c=0;c<b;c++){var e=this.pluginSets[a][c],f="",f="object"===typeof e?e.name:e,d=this.pluginConstructors[f];d&&(d=new d(this._ice),this.plugins[f]=d,!0===
ice.dom.isset(e.settings)&&d.setSettings(e.settings),d.start())}},setActivePlugin:function(a){this.activePlugin=a},getActivePlugin:function(){return this.activePlugin},_getPluginName:function(a){a=a.toString();return a.substr(9,a.indexOf("(")-9)},removePlugin:function(a){this.plugins[a]&&this.plugins[a].remove()},getPlugin:function(a){return this.plugins[a]},usePlugins:function(a,b,c){var e=this;this.pluginSets[a]=!0===ice.dom.isset(b)?b:[];this.loadPlugins(this.pluginSets[a].concat([]),function(){e._enableSet(a);
c&&c.call(this)})},disablePlugin:function(a){this.plugins[a].disable()},isPluginElement:function(a){for(var b in this.plugins)if(this.plugins[b].isPluginElement&&!0===this.plugins[b].isPluginElement(a))return!0;return!1},fireKeyPressed:function(a){if(!1===this._fireKeyPressFns(a,"all_keys"))return!1;var b=[];(!0===a.ctrlKey||!0===a.metaKey)&&b.push("ctrl");!0===a.shiftKey&&b.push("shift");!0===a.altKey&&b.push("alt");switch(a.keyCode){case 13:b.push("enter");break;case ice.dom.DOM_VK_LEFT:b.push("left");
break;case ice.dom.DOM_VK_RIGHT:b.push("right");break;case ice.dom.DOM_VK_UP:b.push("up");break;case ice.dom.DOM_VK_DOWN:b.push("down");break;case 9:b.push("tab");break;case ice.dom.DOM_VK_DELETE:b.push("delete");break;default:var c;a.keyCode?c=a.keyCode:a.which&&(c=a.which);c&&b.push(String.fromCharCode(c).toLowerCase())}b=b.sort().join("+");return this._fireKeyPressFns(a,b)},_fireKeyPressFns:function(a,b){if(this.keyPressListeners[b])for(var c=this.keyPressListeners[b].length,e=0;e<c;e++){var f=
this.keyPressListeners[b][e],d=f.fn,g=f.plugin,f=f.data;if(d)if(!0===ice.dom.isFn(d)){if(!0===d.call(g,a,f))return ice.dom.preventDefault(a),!1}else if(g[d]&&!0===g[d].call(g,a,f))return ice.dom.preventDefault(a),!1}return!0},fireSelectionChanged:function(a){for(var b in this.plugins)this.plugins[b].selectionChanged(a)},fireNodeInserted:function(a,b){for(var c in this.plugins)if(!1===this.plugins[c].nodeInserted(a,b))return!1},fireNodeCreated:function(a,b){for(var c in this.plugins)if(!1===this.plugins[c].nodeCreated(a,
b))return!1},fireCaretPositioned:function(){for(var a in this.plugins)this.plugins[a].caretPositioned()},fireClicked:function(a){var b=!0,c;for(c in this.plugins)!1===this.plugins[c].clicked(a)&&(b=!1);return b},fireMouseDown:function(a){var b=!0,c;for(c in this.plugins)!1===this.plugins[c].mouseDown(a)&&(b=!1);return b},fireKeyDown:function(a){var b=!0,c;for(c in this.plugins)!1===this.plugins[c].keyDown(a)&&(b=!1);return b},fireKeyPress:function(a){var b=!0,c;for(c in this.plugins)!1===this.plugins[c].keyPress(a)&&
(b=!1);return b},fireEnabled:function(a){for(var b in this.plugins)this.plugins[b].setEnabled(a)},fireDisabled:function(a){for(var b in this.plugins)this.plugins[b].setDisabled(a)},fireCaretUpdated:function(){for(var a in this.plugins)this.plugins[a].caretUpdated&&this.plugins[a].caretUpdated()}};this._plugin={};this.IcePluginManager=h}).call(this.ice);